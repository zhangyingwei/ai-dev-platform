<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éœ€æ±‚ç®¡ç† - AIå¼€å‘å¹³å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/styles.css">
    <!-- EasyMDE CSS -->
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <!-- EasyMDE JS -->
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // ä¸»è‰²è°ƒ - é»‘ç™½æç®€é£æ ¼
                        primary: '#000000',
                        'primary-foreground': '#ffffff',

                        // æ¬¡è¦è‰²è°ƒ
                        secondary: '#f8f9fa',
                        'secondary-foreground': '#1f2937',

                        // èƒŒæ™¯è‰²
                        background: '#ffffff',
                        card: '#ffffff',
                        popover: '#ffffff',

                        // é™éŸ³è‰²è°ƒ
                        muted: '#f1f5f9',
                        'muted-foreground': '#64748b',

                        // å¼ºè°ƒè‰²è°ƒ
                        accent: '#f8fafc',
                        'accent-foreground': '#0f172a',

                        // æ–‡å­—è‰²
                        foreground: '#0f172a',

                        // è¾¹æ¡†è‰²
                        border: '#e2e8f0',
                        input: '#e2e8f0',
                        ring: '#94a3b8',

                        // åŠŸèƒ½è‰²
                        success: '#16a34a',
                        'success-foreground': '#ffffff',
                        warning: '#ea580c',
                        'warning-foreground': '#ffffff',
                        destructive: '#dc2626',
                        'destructive-foreground': '#ffffff'
                    },
                    fontFamily: {
                        'sans': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'],
                        'mono': ['SFMono-Regular', 'Consolas', 'Liberation Mono', 'Menlo', 'Courier', 'monospace']
                    },
                    fontSize: {
                        'xs': '10px',
                        'sm': '12px',
                        'base': '14px',
                        'lg': '16px',
                        'xl': '18px',
                        '2xl': '20px',
                        '3xl': '24px',
                        '4xl': '30px',
                        '5xl': '38px'
                    },
                    spacing: {
                        'xs': '4px',
                        'sm': '8px',
                        'md': '16px',
                        'lg': '24px',
                        'xl': '32px',
                        'xxl': '48px'
                    },
                    borderRadius: {
                        'sm': '2px',
                        'base': '6px',
                        'lg': '8px',
                        'xl': '12px'
                    },
                    boxShadow: {
                        'sm': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'base': '0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)',
                        'md': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                        'xl': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
                        'focus': '0 0 0 3px rgba(0, 0, 0, 0.1)'
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 222.2 47.4% 11.2%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96%;
            --secondary-foreground: 222.2 84% 4.9%;
            --muted: 210 40% 96%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96%;
            --accent-foreground: 222.2 84% 4.9%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 222.2 84% 4.9%;
            --warning: 38 92% 50%;
            --warning-foreground: 48 96% 89%;
            --success: 142 76% 36%;
            --success-foreground: 355 100% 97%;
        }

        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 210 40% 98%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 212.7 26.8% 83.9%;
        }

        /* äºŒçº§èœå•æ ·å¼ */
        .nav-toggle {
            cursor: pointer;
        }
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .submenu.expanded {
            max-height: 200px;
        }
        .chevron-icon {
            transition: transform 0.2s ease-out;
        }
        .chevron-icon.rotated {
            transform: rotate(90deg);
        }

        /* éœ€æ±‚æ‹†åˆ†é¡µé¢æ ·å¼ */
        .requirement-item.active {
            background-color: hsl(var(--accent));
            border-color: hsl(var(--primary));
        }

        .requirement-item {
            transition: all 0.2s ease;
        }

        .requirement-item:hover {
            background-color: hsl(var(--accent));
        }

        /* éœ€æ±‚é¡¹ä¸»è¦å†…å®¹åŒºåŸŸæ ·å¼ */
        .requirement-item .flex-1 {
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .requirement-item .flex-1:hover {
            background-color: hsl(var(--muted) / 0.5);
        }

        /* è¯¦æƒ…æŒ‰é’®åŒºåŸŸæ ·å¼ */
        .requirement-item .flex.flex-col.items-end {
            cursor: default;
        }

        /* æ¨¡æ€æ¡†åŠ¨ç”» */
        #add-sub-requirement-modal, #ai-breakdown-modal {
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* AIæ‹†åˆ†ç›¸å…³æ ·å¼ */
        .ai-breakdown-result {
            transition: all 0.2s ease;
        }

        .ai-breakdown-result:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* åŠ è½½åŠ¨ç”» */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        /* æˆåŠŸæç¤ºæ ·å¼ */
        .toast-success {
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* EasyMDEç¼–è¾‘å™¨è‡ªå®šä¹‰æ ·å¼ */
        .EasyMDEContainer {
            border: none !important;
        }

        .EasyMDEContainer .editor-toolbar {
            background-color: hsl(var(--muted)) !important;
            border-top: none !important;
            border-left: none !important;
            border-right: none !important;
            border-bottom: 1px solid hsl(var(--border)) !important;
        }

        .EasyMDEContainer .editor-toolbar button {
            color: hsl(var(--foreground)) !important;
        }

        .EasyMDEContainer .editor-toolbar button:hover {
            background-color: hsl(var(--accent)) !important;
        }

        .EasyMDEContainer .CodeMirror {
            background-color: hsl(var(--background)) !important;
            color: hsl(var(--foreground)) !important;
            border: none !important;
        }

        .EasyMDEContainer .CodeMirror-cursor {
            border-left: 1px solid hsl(var(--foreground)) !important;
        }

        .EasyMDEContainer .editor-preview {
            background-color: hsl(var(--background)) !important;
            color: hsl(var(--foreground)) !important;
        }

        .EasyMDEContainer .editor-preview h1,
        .EasyMDEContainer .editor-preview h2,
        .EasyMDEContainer .editor-preview h3,
        .EasyMDEContainer .editor-preview h4,
        .EasyMDEContainer .editor-preview h5,
        .EasyMDEContainer .editor-preview h6 {
            color: hsl(var(--foreground)) !important;
        }

        .EasyMDEContainer .editor-preview code {
            background-color: hsl(var(--muted)) !important;
            color: hsl(var(--foreground)) !important;
        }

        .EasyMDEContainer .editor-preview pre {
            background-color: hsl(var(--muted)) !important;
        }

        .EasyMDEContainer .editor-preview blockquote {
            border-left: 4px solid hsl(var(--border)) !important;
            background-color: hsl(var(--muted)) !important;
        }
    </style>
</head>
<body class="bg-background text-foreground">
    <div class="flex h-screen">
        <!-- ä¾§è¾¹æ  -->
        <div class="w-64 bg-card border-r border-border flex flex-col">
            <!-- Logo -->
            <div class="p-4 border-b border-border">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
                        <span class="text-primary-foreground font-bold text-sm">AI</span>
                    </div>
                    <span class="font-semibold text-lg">å¼€å‘å¹³å°</span>
                </div>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <nav class="flex-1 p-3 space-y-1">
                <div class="mb-3">
                    <p class="text-xs font-medium text-muted-foreground uppercase tracking-wider px-2 py-1">ä¸»è¦åŠŸèƒ½</p>
                </div>
                <a href="../index.html" class="nav-item flex items-center space-x-2 px-2 py-2 rounded-md hover:bg-accent hover:text-accent-foreground">
                    <div class="w-4 h-4 flex items-center justify-center">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium">å·¥ä½œå°</span>
                </a>
                <a href="requirement-management.html" class="nav-item active flex items-center space-x-2 px-2 py-2 rounded-md bg-accent text-accent-foreground shadow-sm">
                    <div class="w-4 h-4 flex items-center justify-center">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium">éœ€æ±‚ç®¡ç†</span>
                </a>
                <a href="project-management.html" class="nav-item flex items-center space-x-2 px-2 py-2 rounded-md hover:bg-accent hover:text-accent-foreground">
                    <div class="w-4 h-4 flex items-center justify-center">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2v1a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V6a2 2 0 00-2-2V3a2 2 0 012-2v1a2 2 0 00-2 2H6a2 2 0 00-2 2z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium">é¡¹ç›®ç®¡ç†</span>
                </a>

                <div class="mt-4 mb-3">
                    <p class="text-xs font-medium text-muted-foreground uppercase tracking-wider px-2 py-1">ç®¡ç†åŠŸèƒ½</p>
                </div>
                <a href="ai-coding-assistant.html" class="nav-item flex items-center space-x-2 px-2 py-2 rounded-md hover:bg-accent hover:text-accent-foreground">
                    <div class="w-4 h-4 flex items-center justify-center">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium">AIç¼–ç åŠ©æ‰‹ç®¡ç†</span>
                </a>

                <!-- å¼€å‘èµ„æºç®¡ç† - äºŒçº§èœå• -->
                <div class="nav-group">
                    <button class="nav-item nav-toggle flex items-center justify-between w-full px-2 py-2 rounded-md hover:bg-accent hover:text-accent-foreground" data-target="resource-submenu">
                        <div class="flex items-center space-x-2">
                            <div class="w-4 h-4 flex items-center justify-center">
                                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 002 2H4a2 2 0 01-2-2V5zm3 1h6v4H5V6zm6 6H5v2h6v-2z" clip-rule="evenodd"/>
                                    <path d="M15 7h1a2 2 0 012 2v5.5a1.5 1.5 0 01-3 0V9a1 1 0 00-1-1h-1v-1z"/>
                                </svg>
                            </div>
                            <span class="text-sm font-medium">å¼€å‘èµ„æºç®¡ç†</span>
                        </div>
                        <svg class="w-4 h-4 transition-transform duration-200 chevron-icon" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 111.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                    <div id="resource-submenu" class="submenu hidden ml-6 mt-1 space-y-1">
                        <a href="database-management.html" class="nav-item flex items-center space-x-2 px-2 py-1.5 rounded-md hover:bg-accent hover:text-accent-foreground text-sm">
                            <div class="w-3 h-3 flex items-center justify-center">
                                <svg class="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zM3 16a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                                </svg>
                            </div>
                            <span class="font-medium">æ•°æ®åº“ç®¡ç†</span>
                        </a>
                        <a href="application-management.html" class="nav-item flex items-center space-x-2 px-2 py-1.5 rounded-md hover:bg-accent hover:text-accent-foreground text-sm">
                            <div class="w-3 h-3 flex items-center justify-center">
                                <svg class="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h12a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zm2 0v8h12V6H4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <span class="font-medium">åº”ç”¨æœåŠ¡ç®¡ç†</span>
                        </a>
                        <a href="code-management.html" class="nav-item flex items-center space-x-2 px-2 py-1.5 rounded-md hover:bg-accent hover:text-accent-foreground text-sm">
                            <div class="w-3 h-3 flex items-center justify-center">
                                <svg class="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <span class="font-medium">ä»£ç ç®¡ç†</span>
                        </a>
                        <a href="server-management.html" class="nav-item flex items-center space-x-2 px-2 py-1.5 rounded-md hover:bg-accent hover:text-accent-foreground text-sm">
                            <div class="w-3 h-3 flex items-center justify-center">
                                <svg class="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <span class="font-medium">æœåŠ¡å™¨ç®¡ç†</span>
                        </a>
                    </div>
                </div>
                <a href="system-management.html" class="nav-item flex items-center space-x-2 px-2 py-2 rounded-md hover:bg-accent hover:text-accent-foreground">
                    <div class="w-4 h-4 flex items-center justify-center">
                        <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium">ç³»ç»Ÿç®¡ç†</span>
                </a>
            </nav>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="flex-1 flex flex-col">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="bg-card border-b border-border px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2 text-sm text-muted-foreground">
                        <span>é¦–é¡µ</span>
                        <span>/</span>
                        <span class="text-foreground">éœ€æ±‚ç®¡ç†</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button class="p-2 hover:bg-accent rounded-md">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                                <span class="text-primary-foreground text-sm font-medium">ç®¡</span>
                            </div>
                            <span class="text-sm font-medium">ç®¡ç†å‘˜</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- é¡µé¢å†…å®¹ -->
            <main class="flex-1 p-6 overflow-auto" id="main-content">
                <!-- éœ€æ±‚ç®¡ç†é¡µé¢å†…å®¹ -->
                <div class="space-y-6">
                    <!-- é¡µé¢æ ‡é¢˜å’Œæ“ä½œæŒ‰é’® -->
                    <div class="flex items-center justify-between">
                        <h1 class="text-xl font-bold">éœ€æ±‚ç®¡ç†</h1>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1.5 border border-border rounded-md hover:bg-accent transition-colors text-sm font-medium" data-action="requirement-templates">
                                éœ€æ±‚æ¨¡æ¿
                            </button>
                            <button class="px-3 py-1.5 border border-border rounded-md hover:bg-accent transition-colors text-sm font-medium" data-action="batch-operations">
                                æ‰¹é‡æ“ä½œ
                            </button>
                        </div>
                    </div>

                    <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
                    <nav class="border-b border-border">
                        <div class="flex space-x-8">
                            <button class="py-2 px-1 border-b-2 border-primary text-primary font-medium text-sm" data-tab="requirement-input">
                                éœ€æ±‚å½•å…¥
                            </button>
                            <button class="py-2 px-1 border-b-2 border-transparent text-muted-foreground hover:text-foreground text-sm" data-tab="requirement-approval">
                                éœ€æ±‚å®¡æ‰¹
                            </button>
                            <button class="py-2 px-1 border-b-2 border-transparent text-muted-foreground hover:text-foreground text-sm" data-tab="requirement-breakdown">
                                éœ€æ±‚æ‹†åˆ†
                            </button>
                        </div>
                    </nav>

                    <!-- éœ€æ±‚å½•å…¥ç•Œé¢ -->
                    <div class="w-full" data-tab-content="requirement-input">
                        <h2 class="text-lg font-semibold mb-6">å½•å…¥æ–°éœ€æ±‚</h2>
                        <div class="space-y-6">
                            <!-- æ¨¡å—1ï¼šéœ€æ±‚æ¥æºä¸åˆ†ç±» -->
                            <div class="bg-card border border-border rounded-lg p-4">
                                <h3 class="text-base font-medium mb-4 text-foreground">éœ€æ±‚æ¥æºä¸åˆ†ç±»</h3>
                                <div class="space-y-6">
                                    <!-- å½’å±é¡¹ç›® -->
                                    <div>
                                        <label class="block text-sm font-medium mb-2">å½’å±é¡¹ç›®</label>
                                        <select class="w-full px-3 py-2 border border-border rounded-md" id="requirement-project">
                                            <option value="">è¯·é€‰æ‹©é¡¹ç›®</option>
                                            <option value="project-001">AIå¼€å‘å¹³å°</option>
                                            <option value="project-002">ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ</option>
                                            <option value="project-003">æ•°æ®åˆ†æå¹³å°</option>
                                            <option value="project-004">ç§»åŠ¨ç«¯åº”ç”¨</option>
                                            <option value="project-005">ä¼ä¸šé—¨æˆ·ç½‘ç«™</option>
                                        </select>
                                    </div>
                                    <!-- éœ€æ±‚æ¥æº -->
                                    <div>
                                        <label class="block text-sm font-medium mb-2">éœ€æ±‚æ¥æº</label>
                                        <select class="w-full px-3 py-2 border border-border rounded-md" id="requirement-source">
                                            <option value="">è¯·é€‰æ‹©æ¥æº</option>
                                            <option value="customer">å®¢æˆ·åé¦ˆ</option>
                                            <option value="market">å¸‚åœºè°ƒç ”</option>
                                            <option value="internal">å†…éƒ¨éœ€æ±‚</option>
                                            <option value="competitor">ç«å“åˆ†æ</option>
                                            <option value="operation">è¿è¥éœ€æ±‚</option>
                                            <option value="technical">æŠ€æœ¯ä¼˜åŒ–</option>
                                        </select>
                                    </div>
                                    <!-- éœ€æ±‚åˆ†ç±» -->
                                    <div>
                                        <label class="block text-sm font-medium mb-2">éœ€æ±‚åˆ†ç±»</label>
                                        <div class="grid grid-cols-2 gap-2">
                                            <button class="px-3 py-2 bg-primary text-primary-foreground rounded-md text-sm" data-category="functional">åŠŸèƒ½éœ€æ±‚</button>
                                            <button class="px-3 py-2 bg-muted text-muted-foreground rounded-md text-sm" data-category="performance">æ€§èƒ½éœ€æ±‚</button>
                                            <button class="px-3 py-2 bg-muted text-muted-foreground rounded-md text-sm" data-category="ui">ç•Œé¢éœ€æ±‚</button>
                                            <button class="px-3 py-2 bg-muted text-muted-foreground rounded-md text-sm" data-category="integration">é›†æˆéœ€æ±‚</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ¨¡å—2ï¼šéœ€æ±‚æè¿° -->
                            <div class="bg-card border border-border rounded-lg p-4">
                                <h3 class="text-base font-medium mb-4 text-foreground">éœ€æ±‚æè¿°</h3>
                                <div class="space-y-4">
                                    <!-- EasyMDE Markdownç¼–è¾‘å™¨ -->
                                    <div>
                                        <label class="block text-sm font-medium mb-3">è¯¦ç»†æè¿° <span class="text-muted-foreground">(æ”¯æŒMarkdownæ ¼å¼)</span></label>
                                        <div class="border border-border rounded-md overflow-hidden">
                                            <textarea id="requirement-description" style="display: none;">## åŠŸèƒ½æ¦‚è¿°
ç®€è¦è¯´æ˜éœ€æ±‚çš„æ ¸å¿ƒåŠŸèƒ½

## è¯¦ç»†éœ€æ±‚
- åŠŸèƒ½ç‚¹1ï¼šå…·ä½“æè¿°
- åŠŸèƒ½ç‚¹2ï¼šå…·ä½“æè¿°

## ä½¿ç”¨åœºæ™¯
æè¿°å…·ä½“çš„ä½¿ç”¨åœºæ™¯å’Œç”¨æˆ·æ•…äº‹

## éªŒæ”¶æ ‡å‡†
- [ ] éªŒæ”¶æ¡ä»¶1
- [ ] éªŒæ”¶æ¡ä»¶2

## æŠ€æœ¯è¦æ±‚
å¦‚æœ‰ç‰¹æ®ŠæŠ€æœ¯è¦æ±‚è¯·åœ¨æ­¤è¯´æ˜

## å‚è€ƒèµ„æ–™
ç›¸å…³çš„å‚è€ƒé“¾æ¥æˆ–æ–‡æ¡£</textarea>
                                        </div>
                                        <!-- ç¼–è¾‘å™¨åº•éƒ¨çŠ¶æ€æ  -->
                                        <div class="bg-muted border border-t-0 border-border px-3 py-2 flex items-center justify-between text-xs text-muted-foreground rounded-b-md">
                                            <div class="flex items-center space-x-4">
                                                <span id="char-count">å­—ç¬¦æ•°: 0</span>
                                                <span id="word-count">å•è¯æ•°: 0</span>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span>æ”¯æŒMarkdownè¯­æ³•</span>
                                                <button class="text-primary hover:underline" onclick="showMarkdownHelp()">
                                                    è¯­æ³•å¸®åŠ©
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ¨¡å—3ï¼šå®¢æˆ·ä¿¡æ¯ï¼ˆå¯æŠ˜å ï¼‰ -->
                            <div class="bg-card border border-border rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4 cursor-pointer" data-toggle="customer-info">
                                    <h3 class="text-base font-medium text-foreground">å®¢æˆ·ä¿¡æ¯</h3>
                                    <button class="text-muted-foreground hover:text-foreground transition-transform duration-200" data-chevron="customer-info">
                                        <svg class="w-4 h-4 transform rotate-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="hidden" data-content="customer-info">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2">å®¢æˆ·å…¬å¸</label>
                                            <input type="text" class="w-full px-3 py-2 border border-border rounded-md" placeholder="å®¢æˆ·å…¬å¸">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2">è”ç³»äºº</label>
                                            <input type="text" class="w-full px-3 py-2 border border-border rounded-md" placeholder="è”ç³»äºº">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ¨¡å—4ï¼šä¼˜å…ˆçº§ä¸é™„ä»¶ -->
                            <div class="bg-card border border-border rounded-lg p-4">
                                <h3 class="text-base font-medium mb-4 text-foreground">ä¼˜å…ˆçº§ä¸é™„ä»¶</h3>
                                <div class="space-y-4">
                                    <!-- ä¼˜å…ˆçº§ -->
                                    <div>
                                        <label class="block text-sm font-medium mb-2">ä¼˜å…ˆçº§</label>
                                        <div class="grid grid-cols-3 gap-2">
                                            <button class="px-3 py-2 bg-muted text-muted-foreground rounded-md text-sm" data-priority="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</button>
                                            <button class="px-3 py-2 bg-warning text-warning-foreground rounded-md text-sm" data-priority="medium">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</button>
                                            <button class="px-3 py-2 bg-muted text-muted-foreground rounded-md text-sm" data-priority="low">ğŸŸ¢ ä½ä¼˜å…ˆçº§</button>
                                        </div>
                                    </div>

                                    <!-- é™„ä»¶ä¸Šä¼  -->
                                    <div>
                                        <label class="block text-sm font-medium mb-2">é™„ä»¶ä¸Šä¼ </label>
                                        <div class="border-2 border-dashed border-border rounded-md p-6 text-center">
                                            <button class="text-sm text-muted-foreground hover:text-foreground" data-action="upload-file">
                                                ğŸ“ ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶<br>æˆ–æ‹–æ‹½åˆ°æ­¤å¤„
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ“ä½œæŒ‰é’® -->
                            <div class="flex justify-between items-center pt-6">
                                <button class="px-4 py-2 border border-border rounded-md hover:bg-accent text-sm" data-action="use-template">
                                    ğŸ“‹ ä½¿ç”¨æ¨¡æ¿
                                </button>
                                <div class="flex space-x-3">
                                    <button class="px-6 py-2 border border-border rounded-md hover:bg-accent text-sm" data-action="save-draft">ä¿å­˜è‰ç¨¿</button>
                                    <button class="px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-gray-800 text-sm font-medium" data-action="submit-approval">æäº¤å®¡æ‰¹</button>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- éœ€æ±‚å®¡æ‰¹ç•Œé¢ -->
                    <div class="hidden" data-tab-content="requirement-approval">
                        <div class="bg-card border border-border rounded-lg p-4">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-lg font-semibold">éœ€æ±‚å®¡æ‰¹</h2>
                                <!-- Button Group ç»„ä»¶ -->
                                <div class="flex bg-muted rounded-md p-1">
                                    <button class="px-3 py-1.5 bg-primary text-primary-foreground rounded text-sm font-medium" data-approval-filter="pending">
                                        å¾…å®¡æ‰¹éœ€æ±‚
                                    </button>
                                    <button class="px-3 py-1.5 text-muted-foreground hover:text-foreground rounded text-sm font-medium" data-approval-filter="approved">
                                        å·²å®¡æ‰¹éœ€æ±‚
                                    </button>
                                </div>
                            </div>

                            <!-- ç­›é€‰å™¨åŒºåŸŸ -->
                            <div class="bg-muted/30 border border-border rounded-lg p-4 mb-4">
                                <h3 class="text-sm font-medium mb-3 text-foreground">ç­›é€‰æ¡ä»¶</h3>
                                <div class="space-y-4">
                                    <!-- å½’å±é¡¹ç›®ç­›é€‰ -->
                                    <div>
                                        <label class="block text-xs font-medium mb-2 text-muted-foreground">å½’å±é¡¹ç›®</label>
                                        <select class="w-full px-3 py-2 border border-border rounded-md text-sm" id="approval-project-filter">
                                            <option value="">å…¨éƒ¨é¡¹ç›®</option>
                                            <option value="project-001">AIå¼€å‘å¹³å°</option>
                                            <option value="project-002">ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ</option>
                                            <option value="project-003">æ•°æ®åˆ†æå¹³å°</option>
                                            <option value="project-004">ç§»åŠ¨ç«¯åº”ç”¨</option>
                                            <option value="project-005">ä¼ä¸šé—¨æˆ·ç½‘ç«™</option>
                                        </select>
                                    </div>
                                    <!-- éœ€æ±‚æ¥æºç­›é€‰ -->
                                    <div>
                                        <label class="block text-xs font-medium mb-2 text-muted-foreground">éœ€æ±‚æ¥æº</label>
                                        <select class="w-full px-3 py-2 border border-border rounded-md text-sm" id="approval-source-filter">
                                            <option value="">å…¨éƒ¨æ¥æº</option>
                                            <option value="customer">å®¢æˆ·åé¦ˆ</option>
                                            <option value="market">å¸‚åœºè°ƒç ”</option>
                                            <option value="internal">å†…éƒ¨éœ€æ±‚</option>
                                            <option value="competitor">ç«å“åˆ†æ</option>
                                            <option value="operation">è¿è¥éœ€æ±‚</option>
                                            <option value="technical">æŠ€æœ¯ä¼˜åŒ–</option>
                                        </select>
                                    </div>
                                    <!-- éœ€æ±‚åˆ†ç±»ç­›é€‰ -->
                                    <div>
                                        <label class="block text-xs font-medium mb-2 text-muted-foreground">éœ€æ±‚åˆ†ç±»</label>
                                        <div class="flex flex-wrap gap-2">
                                            <button class="px-2 py-1 bg-primary text-primary-foreground rounded text-xs" data-category-filter="all">å…¨éƒ¨</button>
                                            <button class="px-2 py-1 bg-muted text-muted-foreground rounded text-xs hover:bg-accent" data-category-filter="functional">åŠŸèƒ½éœ€æ±‚</button>
                                            <button class="px-2 py-1 bg-muted text-muted-foreground rounded text-xs hover:bg-accent" data-category-filter="performance">æ€§èƒ½éœ€æ±‚</button>
                                            <button class="px-2 py-1 bg-muted text-muted-foreground rounded text-xs hover:bg-accent" data-category-filter="ui">ç•Œé¢éœ€æ±‚</button>
                                            <button class="px-2 py-1 bg-muted text-muted-foreground rounded text-xs hover:bg-accent" data-category-filter="integration">é›†æˆéœ€æ±‚</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å¾…å®¡æ‰¹éœ€æ±‚åˆ—è¡¨ -->
                            <div class="space-y-3" data-approval-content="pending">
                                <div class="p-4 border border-border rounded hover:bg-accent cursor-pointer hover-card" data-requirement-id="req-001" data-project="project-002" data-source="customer" data-category="functional">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="font-medium text-sm">ç”¨æˆ·ç™»å½•ä¼˜åŒ–éœ€æ±‚</h3>
                                            <p class="text-xs text-muted-foreground mt-1">æäº¤äºº: å¼ é”€å”® | é¡¹ç›®: ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ | æ¥æº: å®¢æˆ·åé¦ˆ | æäº¤æ—¶é—´: 2å°æ—¶å‰</p>
                                            <p class="text-sm mt-2">ç”¨æˆ·å¸Œæœ›èƒ½å¤Ÿé€šè¿‡æ‰‹æœºå·å¿«é€Ÿç™»å½•ç³»ç»Ÿï¼Œæå‡ç™»å½•ä½“éªŒå’Œå®‰å…¨æ€§ã€‚åŒ…æ‹¬æ‰‹æœºå·éªŒè¯ã€çŸ­ä¿¡éªŒè¯ç ã€ç™»å½•çŠ¶æ€ç®¡ç†ç­‰åŠŸèƒ½ã€‚</p>
                                            <div class="flex items-center space-x-2 mt-2">
                                                <span class="px-2 py-1 bg-primary text-primary-foreground text-xs rounded">åŠŸèƒ½éœ€æ±‚</span>
                                                <span class="px-2 py-1 bg-warning text-warning-foreground text-xs rounded">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col space-y-2 ml-4">
                                            <button class="px-3 py-1 bg-success text-success-foreground text-xs rounded hover:bg-green-600" data-action="approve-requirement" data-requirement-id="req-001">âœ… é€šè¿‡</button>
                                            <button class="px-3 py-1 bg-destructive text-destructive-foreground text-xs rounded hover:bg-red-600" data-action="reject-requirement" data-requirement-id="req-001">âŒ æ‹’ç»</button>
                                            <button class="px-3 py-1 border border-border text-xs rounded hover:bg-accent" data-action="edit-requirement" data-requirement-id="req-001">ğŸ“ ç¼–è¾‘</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 border border-border rounded hover:bg-accent cursor-pointer hover-card" data-requirement-id="req-002" data-project="project-005" data-source="market" data-category="functional">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="font-medium text-sm">æ”¯ä»˜åŠŸèƒ½å¢å¼º</h3>
                                            <p class="text-xs text-muted-foreground mt-1">æäº¤äºº: æäº§å“ | é¡¹ç›®: ä¼ä¸šé—¨æˆ·ç½‘ç«™ | æ¥æº: å¸‚åœºè°ƒç ” | æäº¤æ—¶é—´: 1å¤©å‰</p>
                                            <p class="text-sm mt-2">å¢åŠ å¤šç§æ”¯ä»˜æ–¹å¼ï¼Œæ”¯æŒå¾®ä¿¡ã€æ”¯ä»˜å®ç­‰ç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ï¼Œæå‡ç”¨æˆ·æ”¯ä»˜ä½“éªŒå’ŒæˆåŠŸç‡ã€‚</p>
                                            <div class="flex items-center space-x-2 mt-2">
                                                <span class="px-2 py-1 bg-primary text-primary-foreground text-xs rounded">åŠŸèƒ½éœ€æ±‚</span>
                                                <span class="px-2 py-1 bg-destructive text-destructive-foreground text-xs rounded">ğŸ”´ é«˜ä¼˜å…ˆçº§</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col space-y-2 ml-4">
                                            <button class="px-3 py-1 bg-success text-success-foreground text-xs rounded hover:bg-green-600" data-action="approve-requirement" data-requirement-id="req-002">âœ… é€šè¿‡</button>
                                            <button class="px-3 py-1 bg-destructive text-destructive-foreground text-xs rounded hover:bg-red-600" data-action="reject-requirement" data-requirement-id="req-002">âŒ æ‹’ç»</button>
                                            <button class="px-3 py-1 border border-border text-xs rounded hover:bg-accent" data-action="edit-requirement" data-requirement-id="req-002">ğŸ“ ç¼–è¾‘</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 border border-border rounded hover:bg-accent cursor-pointer hover-card" data-requirement-id="req-003" data-project="project-003" data-source="internal" data-category="performance">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="font-medium text-sm">æ•°æ®ç»Ÿè®¡æŠ¥è¡¨åŠŸèƒ½</h3>
                                            <p class="text-xs text-muted-foreground mt-1">æäº¤äºº: ç‹è¿è¥ | é¡¹ç›®: æ•°æ®åˆ†æå¹³å° | æ¥æº: å†…éƒ¨éœ€æ±‚ | æäº¤æ—¶é—´: 3å¤©å‰</p>
                                            <p class="text-sm mt-2">å¢åŠ æ•°æ®ç»Ÿè®¡æŠ¥è¡¨åŠŸèƒ½ï¼Œæ”¯æŒå¤šç»´åº¦æ•°æ®åˆ†æå’Œå¯¼å‡ºï¼Œå¸®åŠ©è¿è¥å›¢é˜Ÿæ›´å¥½åœ°åˆ†æä¸šåŠ¡æ•°æ®ã€‚</p>
                                            <div class="flex items-center space-x-2 mt-2">
                                                <span class="px-2 py-1 bg-secondary text-secondary-foreground text-xs rounded">æ€§èƒ½éœ€æ±‚</span>
                                                <span class="px-2 py-1 bg-muted text-muted-foreground text-xs rounded">ğŸŸ¢ ä½ä¼˜å…ˆçº§</span>
                                            </div>
                                        </div>
                                        <div class="flex flex-col space-y-2 ml-4">
                                            <button class="px-3 py-1 bg-success text-success-foreground text-xs rounded hover:bg-green-600" data-action="approve-requirement" data-requirement-id="req-003">âœ… é€šè¿‡</button>
                                            <button class="px-3 py-1 bg-destructive text-destructive-foreground text-xs rounded hover:bg-red-600" data-action="reject-requirement" data-requirement-id="req-003">âŒ æ‹’ç»</button>
                                            <button class="px-3 py-1 border border-border text-xs rounded hover:bg-accent" data-action="edit-requirement" data-requirement-id="req-003">ğŸ“ ç¼–è¾‘</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å·²å®¡æ‰¹éœ€æ±‚åˆ—è¡¨ -->
                            <div class="space-y-3 hidden" data-approval-content="approved">
                                <div class="p-4 border border-border rounded hover:bg-accent cursor-pointer" data-requirement-id="req-004" data-project="project-002" data-source="internal" data-category="functional">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="font-medium text-sm">ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ</h3>
                                            <p class="text-xs text-muted-foreground mt-1">æäº¤äºº: èµµç®¡ç†å‘˜ | é¡¹ç›®: ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ | æ¥æº: å†…éƒ¨éœ€æ±‚ | å®¡æ‰¹æ—¶é—´: 2024-01-17 15:30</p>
                                            <p class="text-sm mt-2">å®Œå–„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè§’è‰²åˆ†é…å’Œæƒé™æ§åˆ¶ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§å’Œç®¡ç†æ•ˆç‡ã€‚</p>
                                            <div class="flex items-center space-x-2 mt-2">
                                                <span class="px-2 py-1 bg-primary text-primary-foreground text-xs rounded">åŠŸèƒ½éœ€æ±‚</span>
                                                <span class="px-2 py-1 bg-success/10 text-success text-xs rounded">å·²é€šè¿‡</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 ml-4">
                                            <span class="text-xs text-muted-foreground">å®¡æ‰¹äººï¼šæŠ€æœ¯æ€»ç›‘</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-4 border border-border rounded hover:bg-accent cursor-pointer" data-requirement-id="req-005" data-project="project-004" data-source="competitor" data-category="ui">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <h3 class="font-medium text-sm">ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–</h3>
                                            <p class="text-xs text-muted-foreground mt-1">æäº¤äºº: é™ˆå‰ç«¯ | é¡¹ç›®: ç§»åŠ¨ç«¯åº”ç”¨ | æ¥æº: ç«å“åˆ†æ | å®¡æ‰¹æ—¶é—´: 2024-01-16 11:45</p>
                                            <p class="text-sm mt-2">ä¼˜åŒ–ç§»åŠ¨ç«¯é¡µé¢é€‚é…ï¼Œæå‡ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒï¼Œæ”¯æŒå“åº”å¼å¸ƒå±€å’Œè§¦æ‘¸æ“ä½œã€‚</p>
                                            <div class="flex items-center space-x-2 mt-2">
                                                <span class="px-2 py-1 bg-secondary text-secondary-foreground text-xs rounded">ç•Œé¢éœ€æ±‚</span>
                                                <span class="px-2 py-1 bg-success/10 text-success text-xs rounded">å·²é€šè¿‡</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center space-x-2 ml-4">
                                            <span class="text-xs text-muted-foreground">å®¡æ‰¹äººï¼šäº§å“æ€»ç›‘</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                            <div class="flex justify-between items-center mt-4 pt-4 border-t">
                                <div class="text-sm text-muted-foreground" data-approval-count-text="pending">å…± 3 ä¸ªå¾…å®¡æ‰¹éœ€æ±‚</div>
                                <div class="text-sm text-muted-foreground hidden" data-approval-count-text="approved">å…± 2 ä¸ªå·²å®¡æ‰¹éœ€æ±‚</div>
                                <div class="flex space-x-2">
                                    <button class="px-3 py-1.5 border border-border rounded text-sm hover:bg-accent" data-action="batch-approve">æ‰¹é‡é€šè¿‡</button>
                                    <button class="px-3 py-1.5 border border-border rounded text-sm hover:bg-accent" data-action="export-approval-list">å¯¼å‡ºåˆ—è¡¨</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- éœ€æ±‚æ‹†åˆ†ç•Œé¢ -->
                    <div class="hidden" data-tab-content="requirement-breakdown">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 h-full">
                            <!-- å·¦ä¾§é¢æ¿ï¼šå·²å®¡æ‰¹éœ€æ±‚åˆ—è¡¨ -->
                            <div class="bg-card border border-border rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h2 class="text-lg font-semibold">å·²å®¡æ‰¹éœ€æ±‚</h2>
                                    <div class="text-sm text-muted-foreground">
                                        å…± <span id="approved-requirements-count">2</span> ä¸ªéœ€æ±‚
                                    </div>
                                </div>

                                <!-- æœç´¢æ¡† -->
                                <div class="mb-4">
                                    <input type="text" placeholder="æœç´¢éœ€æ±‚..." class="w-full px-3 py-2 border border-border rounded-md text-sm" id="requirement-search">
                                </div>

                                <!-- å·²å®¡æ‰¹éœ€æ±‚åˆ—è¡¨ -->
                                <div class="space-y-3 max-h-96 overflow-y-auto" id="approved-requirements-list">
                                    <div class="p-3 border border-border rounded requirement-item active" data-requirement-id="req-004" data-requirement-name="ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1 p-2 rounded hover:bg-muted/50 transition-colors" title="ç‚¹å‡»é€‰ä¸­æ­¤éœ€æ±‚">
                                                <h3 class="font-medium text-sm">ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ</h3>
                                                <p class="text-xs text-muted-foreground mt-1">æäº¤äºº: èµµç®¡ç†å‘˜ | é¡¹ç›®: ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ | æ¥æº: å†…éƒ¨éœ€æ±‚ | å®¡æ‰¹æ—¶é—´: 2024-01-17 15:30</p>
                                                <div class="flex items-center space-x-2 mt-2">
                                                    <span class="px-2 py-1 bg-primary text-primary-foreground text-xs rounded">åŠŸèƒ½éœ€æ±‚</span>
                                                    <span class="px-2 py-1 bg-success/10 text-success text-xs rounded">å·²é€šè¿‡</span>
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-end space-y-2 ml-2" onclick="event.stopPropagation();">
                                                <span class="text-xs text-muted-foreground">å­éœ€æ±‚: <span class="font-medium">3</span></span>
                                                <button class="px-2 py-1 border border-border rounded text-xs hover:bg-accent" data-action="view-requirement-detail" data-requirement-id="req-004">
                                                    æŸ¥çœ‹è¯¦æƒ…
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-3 border border-border rounded requirement-item" data-requirement-id="req-005" data-requirement-name="ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1 p-2 rounded hover:bg-muted/50 transition-colors" title="ç‚¹å‡»é€‰ä¸­æ­¤éœ€æ±‚">
                                                <h3 class="font-medium text-sm">ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–</h3>
                                                <p class="text-xs text-muted-foreground mt-1">æäº¤äºº: é™ˆå‰ç«¯ | é¡¹ç›®: ç§»åŠ¨ç«¯åº”ç”¨ | æ¥æº: ç«å“åˆ†æ | å®¡æ‰¹æ—¶é—´: 2024-01-16 11:45</p>
                                                <div class="flex items-center space-x-2 mt-2">
                                                    <span class="px-2 py-1 bg-secondary text-secondary-foreground text-xs rounded">ç•Œé¢éœ€æ±‚</span>
                                                    <span class="px-2 py-1 bg-success/10 text-success text-xs rounded">å·²é€šè¿‡</span>
                                                </div>
                                            </div>
                                            <div class="flex flex-col items-end space-y-2 ml-2" onclick="event.stopPropagation();">
                                                <span class="text-xs text-muted-foreground">å­éœ€æ±‚: <span class="font-medium">2</span></span>
                                                <button class="px-2 py-1 border border-border rounded text-xs hover:bg-accent" data-action="view-requirement-detail" data-requirement-id="req-005">
                                                    æŸ¥çœ‹è¯¦æƒ…
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- å³ä¾§é¢æ¿ï¼šå­éœ€æ±‚ç®¡ç† -->
                            <div class="bg-card border border-border rounded-lg p-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h2 class="text-lg font-semibold">å­éœ€æ±‚ç®¡ç†</h2>
                                    <div class="flex space-x-2">
                                        <button class="px-3 py-2 bg-secondary text-secondary-foreground rounded-md hover:bg-secondary/80 text-sm" id="ai-breakdown-btn">
                                            ğŸ¤– AIè¾…åŠ©æ‹†åˆ†
                                        </button>
                                        <button class="px-3 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/80 text-sm" id="add-sub-requirement-btn">
                                            æ–°å¢å­éœ€æ±‚
                                        </button>
                                    </div>
                                </div>

                                <!-- å½“å‰é€‰ä¸­éœ€æ±‚ä¿¡æ¯ -->
                                <div class="mb-4 p-3 bg-muted rounded-lg" id="selected-requirement-info">
                                    <h3 class="font-medium text-sm mb-1" id="selected-requirement-name">ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ</h3>
                                    <p class="text-xs text-muted-foreground" id="selected-requirement-desc">å®Œå–„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè§’è‰²åˆ†é…å’Œæƒé™æ§åˆ¶ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§å’Œç®¡ç†æ•ˆç‡ã€‚</p>
                                </div>

                                <!-- å­éœ€æ±‚åˆ—è¡¨ -->
                                <div class="space-y-3 max-h-96 overflow-y-auto" id="sub-requirements-list">
                                    <div class="p-3 border border-border rounded" data-sub-requirement-id="sub-req-001">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-sm">ç”¨æˆ·è§’è‰²ç®¡ç†æ¨¡å—</h4>
                                                <p class="text-xs text-muted-foreground mt-1">å®ç°ç”¨æˆ·è§’è‰²çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤åŠŸèƒ½ï¼Œæ”¯æŒè§’è‰²æƒé™é…ç½®</p>
                                                <div class="flex items-center space-x-2 mt-2">
                                                    <span class="px-2 py-1 bg-warning text-warning-foreground text-xs rounded">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</span>
                                                    <span class="text-xs text-muted-foreground">é¢„ä¼°å·¥æ—¶: 5å¤©</span>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2 ml-2">
                                                <button class="px-2 py-1 border border-border rounded text-xs hover:bg-accent" data-action="edit-sub-requirement" data-sub-requirement-id="sub-req-001">
                                                    ç¼–è¾‘
                                                </button>
                                                <button class="px-2 py-1 border border-destructive text-destructive rounded text-xs hover:bg-destructive/10" data-action="delete-sub-requirement" data-sub-requirement-id="sub-req-001">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-3 border border-border rounded" data-sub-requirement-id="sub-req-002">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-sm">æƒé™æ§åˆ¶æ¨¡å—</h4>
                                                <p class="text-xs text-muted-foreground mt-1">å®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼Œæ”¯æŒèœå•æƒé™ã€æ“ä½œæƒé™ã€æ•°æ®æƒé™</p>
                                                <div class="flex items-center space-x-2 mt-2">
                                                    <span class="px-2 py-1 bg-destructive text-destructive-foreground text-xs rounded">ğŸ”´ é«˜ä¼˜å…ˆçº§</span>
                                                    <span class="text-xs text-muted-foreground">é¢„ä¼°å·¥æ—¶: 8å¤©</span>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2 ml-2">
                                                <button class="px-2 py-1 border border-border rounded text-xs hover:bg-accent" data-action="edit-sub-requirement" data-sub-requirement-id="sub-req-002">
                                                    ç¼–è¾‘
                                                </button>
                                                <button class="px-2 py-1 border border-destructive text-destructive rounded text-xs hover:bg-destructive/10" data-action="delete-sub-requirement" data-sub-requirement-id="sub-req-002">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="p-3 border border-border rounded" data-sub-requirement-id="sub-req-003">
                                        <div class="flex items-start justify-between">
                                            <div class="flex-1">
                                                <h4 class="font-medium text-sm">ç”¨æˆ·ç®¡ç†ç•Œé¢</h4>
                                                <p class="text-xs text-muted-foreground mt-1">è®¾è®¡å’Œå¼€å‘ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒç”¨æˆ·ä¿¡æ¯ç»´æŠ¤å’Œè§’è‰²åˆ†é…</p>
                                                <div class="flex items-center space-x-2 mt-2">
                                                    <span class="px-2 py-1 bg-muted text-muted-foreground text-xs rounded">ğŸŸ¢ ä½ä¼˜å…ˆçº§</span>
                                                    <span class="text-xs text-muted-foreground">é¢„ä¼°å·¥æ—¶: 3å¤©</span>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2 ml-2">
                                                <button class="px-2 py-1 border border-border rounded text-xs hover:bg-accent" data-action="edit-sub-requirement" data-sub-requirement-id="sub-req-003">
                                                    ç¼–è¾‘
                                                </button>
                                                <button class="px-2 py-1 border border-destructive text-destructive rounded text-xs hover:bg-destructive/10" data-action="delete-sub-requirement" data-sub-requirement-id="sub-req-003">
                                                    åˆ é™¤
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                                <div class="mt-4 pt-4 border-t">
                                    <div class="flex justify-between items-center text-sm text-muted-foreground">
                                        <span>å…± <span id="sub-requirements-count">3</span> ä¸ªå­éœ€æ±‚</span>
                                        <span>æ€»é¢„ä¼°å·¥æ—¶: <span id="total-estimated-hours">16</span> å¤©</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </main>
        </div>
    </div>

    <!-- AIè¾…åŠ©æ‹†åˆ†æ¨¡æ€æ¡† -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="ai-breakdown-modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card border border-border rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
                <div class="flex items-center justify-between p-4 border-b border-border">
                    <h3 class="text-lg font-semibold">ğŸ¤– AIè¾…åŠ©éœ€æ±‚æ‹†åˆ†</h3>
                    <button class="p-2 hover:bg-accent rounded-md" id="close-ai-breakdown-modal">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>

                <!-- æ¨¡æ€æ¡†å†…å®¹ -->
                <div class="p-6 max-h-[70vh] overflow-y-auto">
                    <!-- éœ€æ±‚ä¿¡æ¯å±•ç¤º -->
                    <div class="mb-6 p-4 bg-muted rounded-lg">
                        <h4 class="font-medium text-sm mb-2">å½“å‰éœ€æ±‚</h4>
                        <h5 class="font-medium text-base mb-2" id="ai-breakdown-requirement-name">ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ</h5>
                        <p class="text-sm text-muted-foreground" id="ai-breakdown-requirement-desc">å®Œå–„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè§’è‰²åˆ†é…å’Œæƒé™æ§åˆ¶ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§å’Œç®¡ç†æ•ˆç‡ã€‚</p>
                    </div>

                    <!-- AIæ‹†åˆ†é…ç½® -->
                    <div class="mb-6">
                        <h4 class="font-medium text-sm mb-3">æ‹†åˆ†é…ç½®</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">æ‹†åˆ†ç²’åº¦</label>
                                <select id="ai-breakdown-granularity" class="w-full px-3 py-2 border border-border rounded-md">
                                    <option value="coarse">ç²—ç²’åº¦ï¼ˆ3-5ä¸ªå­éœ€æ±‚ï¼‰</option>
                                    <option value="medium" selected>ä¸­ç²’åº¦ï¼ˆ5-8ä¸ªå­éœ€æ±‚ï¼‰</option>
                                    <option value="fine">ç»†ç²’åº¦ï¼ˆ8-12ä¸ªå­éœ€æ±‚ï¼‰</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">æŠ€æœ¯æ ˆåå¥½</label>
                                <select id="ai-breakdown-tech-stack" class="w-full px-3 py-2 border border-border rounded-md">
                                    <option value="general">é€šç”¨æŠ€æœ¯æ ˆ</option>
                                    <option value="java-spring" selected>Java + Spring</option>
                                    <option value="nodejs">Node.js + Express</option>
                                    <option value="python-django">Python + Django</option>
                                    <option value="dotnet">C# + .NET</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- é¢å¤–è¯´æ˜ -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium mb-2">é¢å¤–è¯´æ˜ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="ai-breakdown-additional-info" rows="3"
                                  class="w-full px-3 py-2 border border-border rounded-md resize-none"
                                  placeholder="è¯·è¾“å…¥ä»»ä½•é¢å¤–çš„éœ€æ±‚è¯´æ˜ã€æŠ€æœ¯çº¦æŸæˆ–ç‰¹æ®Šè¦æ±‚..."></textarea>
                    </div>

                    <!-- AIæ‹†åˆ†ç»“æœå±•ç¤ºåŒºåŸŸ -->
                    <div class="mb-6" id="ai-breakdown-result-section" style="display: none;">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-medium text-sm">AIæ‹†åˆ†ç»“æœ</h4>
                            <div class="flex space-x-2">
                                <button class="px-3 py-1 border border-border rounded text-xs hover:bg-accent" id="regenerate-breakdown">
                                    ğŸ”„ é‡æ–°ç”Ÿæˆ
                                </button>
                                <button class="px-3 py-1 bg-primary text-primary-foreground rounded text-xs hover:bg-primary/80" id="apply-breakdown">
                                    âœ… åº”ç”¨æ‹†åˆ†
                                </button>
                            </div>
                        </div>
                        <div class="space-y-3" id="ai-breakdown-results">
                            <!-- AIç”Ÿæˆçš„å­éœ€æ±‚å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div class="text-center py-8 hidden" id="ai-breakdown-loading">
                        <div class="inline-flex items-center space-x-2">
                            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                            <span class="text-sm text-muted-foreground">AIæ­£åœ¨åˆ†æéœ€æ±‚å¹¶ç”Ÿæˆæ‹†åˆ†æ–¹æ¡ˆ...</span>
                        </div>
                    </div>
                </div>

                <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
                <div class="flex justify-between items-center p-4 border-t border-border">
                    <div class="text-sm text-muted-foreground">
                        ğŸ’¡ AIå°†æ ¹æ®éœ€æ±‚æè¿°å’Œé…ç½®è‡ªåŠ¨ç”Ÿæˆåˆç†çš„å­éœ€æ±‚æ‹†åˆ†æ–¹æ¡ˆ
                    </div>
                    <div class="flex space-x-3">
                        <button type="button" class="px-4 py-2 border border-border rounded-md hover:bg-accent" id="cancel-ai-breakdown">
                            å–æ¶ˆ
                        </button>
                        <button type="button" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/80" id="start-ai-breakdown">
                            å¼€å§‹AIæ‹†åˆ†
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- éœ€æ±‚è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="requirement-detail-modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card border border-border rounded-lg w-full max-w-3xl max-h-[90vh] overflow-hidden">
                <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
                <div class="flex items-center justify-between p-4 border-b border-border">
                    <h3 class="text-lg font-semibold">éœ€æ±‚è¯¦æƒ…</h3>
                    <button class="p-2 hover:bg-accent rounded-md" id="close-requirement-detail-modal">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>

                <!-- æ¨¡æ€æ¡†å†…å®¹ -->
                <div class="p-6 max-h-[70vh] overflow-y-auto">
                    <div class="space-y-6">
                        <!-- åŸºæœ¬ä¿¡æ¯ -->
                        <div>
                            <h4 class="font-medium text-base mb-3" id="detail-requirement-name">ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ</h4>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-muted-foreground">æäº¤äººï¼š</span>
                                    <span id="detail-submitter">èµµç®¡ç†å‘˜</span>
                                </div>
                                <div>
                                    <span class="text-muted-foreground">å®¡æ‰¹æ—¶é—´ï¼š</span>
                                    <span id="detail-approval-time">2024-01-17 15:30</span>
                                </div>
                                <div>
                                    <span class="text-muted-foreground">éœ€æ±‚ç±»å‹ï¼š</span>
                                    <span id="detail-requirement-type">åŠŸèƒ½éœ€æ±‚</span>
                                </div>
                                <div>
                                    <span class="text-muted-foreground">ä¼˜å…ˆçº§ï¼š</span>
                                    <span id="detail-priority">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</span>
                                </div>
                            </div>
                        </div>

                        <!-- éœ€æ±‚æè¿° -->
                        <div>
                            <h5 class="font-medium text-sm mb-2">éœ€æ±‚æè¿°</h5>
                            <div class="p-3 bg-muted rounded-lg text-sm" id="detail-description">
                                å®Œå–„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè§’è‰²åˆ†é…å’Œæƒé™æ§åˆ¶ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§å’Œç®¡ç†æ•ˆç‡ã€‚åŒ…æ‹¬ç”¨æˆ·è§’è‰²ç®¡ç†ã€æƒé™æ§åˆ¶æ¨¡å—ã€ç”¨æˆ·ç®¡ç†ç•Œé¢ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚
                            </div>
                        </div>

                        <!-- ä¸šåŠ¡èƒŒæ™¯ -->
                        <div>
                            <h5 class="font-medium text-sm mb-2">ä¸šåŠ¡èƒŒæ™¯</h5>
                            <div class="p-3 bg-muted rounded-lg text-sm" id="detail-background">
                                éšç€ç³»ç»Ÿç”¨æˆ·æ•°é‡å¢é•¿ï¼Œéœ€è¦å»ºç«‹å®Œå–„çš„æƒé™ç®¡ç†ä½“ç³»ï¼Œç¡®ä¿ä¸åŒè§’è‰²ç”¨æˆ·åªèƒ½è®¿é—®ç›¸åº”çš„åŠŸèƒ½æ¨¡å—ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§ã€‚
                            </div>
                        </div>

                        <!-- éªŒæ”¶æ ‡å‡† -->
                        <div>
                            <h5 class="font-medium text-sm mb-2">éªŒæ”¶æ ‡å‡†</h5>
                            <div class="space-y-2" id="detail-acceptance-criteria">
                                <div class="flex items-start space-x-2">
                                    <span class="text-muted-foreground text-xs mt-1">â€¢</span>
                                    <span class="text-sm">æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç”¨æˆ·è§’è‰²</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-muted-foreground text-xs mt-1">â€¢</span>
                                    <span class="text-sm">å®ç°èœå•æƒé™ã€æ“ä½œæƒé™ã€æ•°æ®æƒé™æ§åˆ¶</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-muted-foreground text-xs mt-1">â€¢</span>
                                    <span class="text-sm">æä¾›ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒè§’è‰²åˆ†é…</span>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="text-muted-foreground text-xs mt-1">â€¢</span>
                                    <span class="text-sm">æƒé™å˜æ›´å®æ—¶ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°ç™»å½•</span>
                                </div>
                            </div>
                        </div>

                        <!-- å­éœ€æ±‚ç»Ÿè®¡ -->
                        <div>
                            <h5 class="font-medium text-sm mb-2">æ‹†åˆ†æƒ…å†µ</h5>
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div class="p-3 bg-muted rounded-lg">
                                    <div class="text-lg font-bold" id="detail-sub-count">3</div>
                                    <div class="text-xs text-muted-foreground">å­éœ€æ±‚æ•°é‡</div>
                                </div>
                                <div class="p-3 bg-muted rounded-lg">
                                    <div class="text-lg font-bold" id="detail-total-hours">16</div>
                                    <div class="text-xs text-muted-foreground">æ€»é¢„ä¼°å·¥æ—¶(å¤©)</div>
                                </div>
                                <div class="p-3 bg-muted rounded-lg">
                                    <div class="text-lg font-bold" id="detail-progress">0%</div>
                                    <div class="text-xs text-muted-foreground">å®Œæˆè¿›åº¦</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
                <div class="flex justify-end space-x-3 p-4 border-t border-border">
                    <button type="button" class="px-4 py-2 border border-border rounded-md hover:bg-accent" id="close-detail-modal">
                        å…³é—­
                    </button>
                    <button type="button" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/80" id="goto-breakdown">
                        è¿›å…¥æ‹†åˆ†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°å¢å­éœ€æ±‚æ¨¡æ€æ¡† -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="add-sub-requirement-modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card border border-border rounded-lg w-full max-w-2xl">
                <!-- æ¨¡æ€æ¡†å¤´éƒ¨ -->
                <div class="flex items-center justify-between p-4 border-b border-border">
                    <h3 class="text-lg font-semibold">æ–°å¢å­éœ€æ±‚</h3>
                    <button class="p-2 hover:bg-accent rounded-md" id="close-sub-requirement-modal">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>

                <!-- æ¨¡æ€æ¡†å†…å®¹ -->
                <div class="p-6">
                    <form id="sub-requirement-form" class="space-y-4">
                        <!-- çˆ¶éœ€æ±‚ä¿¡æ¯ -->
                        <div class="p-3 bg-muted rounded-lg">
                            <h4 class="font-medium text-sm mb-1">çˆ¶éœ€æ±‚</h4>
                            <p class="text-sm" id="parent-requirement-name">ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ</p>
                        </div>

                        <!-- å­éœ€æ±‚åç§° -->
                        <div>
                            <label class="block text-sm font-medium mb-2" for="sub-requirement-name">
                                éœ€æ±‚åç§° <span class="text-destructive">*</span>
                            </label>
                            <input type="text" id="sub-requirement-name" name="name" required
                                   class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                                   placeholder="è¯·è¾“å…¥å­éœ€æ±‚åç§°">
                        </div>

                        <!-- éœ€æ±‚è¯¦ç»†æè¿° -->
                        <div>
                            <label class="block text-sm font-medium mb-2" for="sub-requirement-description">
                                è¯¦ç»†æè¿° <span class="text-destructive">*</span>
                            </label>
                            <textarea id="sub-requirement-description" name="description" required rows="4"
                                      class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary resize-none"
                                      placeholder="è¯·è¯¦ç»†æè¿°å­éœ€æ±‚çš„åŠŸèƒ½å’Œè¦æ±‚..."></textarea>
                        </div>

                        <!-- ä¼˜å…ˆçº§ -->
                        <div>
                            <label class="block text-sm font-medium mb-2" for="sub-requirement-priority">ä¼˜å…ˆçº§</label>
                            <select id="sub-requirement-priority" name="priority"
                                    class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="low">ğŸŸ¢ ä½ä¼˜å…ˆçº§</option>
                                <option value="medium" selected>ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                                <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                            </select>
                        </div>

                        <!-- é¢„ä¼°å·¥æ—¶ -->
                        <div>
                            <label class="block text-sm font-medium mb-2" for="sub-requirement-hours">é¢„ä¼°å·¥æ—¶ï¼ˆå¤©ï¼‰</label>
                            <input type="number" id="sub-requirement-hours" name="hours" min="0.5" step="0.5" value="1"
                                   class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                                   placeholder="è¯·è¾“å…¥é¢„ä¼°å·¥æ—¶">
                        </div>

                        <!-- è´Ÿè´£äºº -->
                        <div>
                            <label class="block text-sm font-medium mb-2" for="sub-requirement-assignee">è´Ÿè´£äºº</label>
                            <select id="sub-requirement-assignee" name="assignee"
                                    class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                                <option value="">è¯·é€‰æ‹©è´Ÿè´£äºº</option>
                                <option value="zhang-pm">å¼ é¡¹ç›®ç»ç†</option>
                                <option value="li-frontend">æå‰ç«¯å¼€å‘</option>
                                <option value="wang-backend">ç‹åç«¯å¼€å‘</option>
                                <option value="zhao-ui">èµµUIè®¾è®¡å¸ˆ</option>
                                <option value="chen-test">é™ˆæµ‹è¯•å·¥ç¨‹å¸ˆ</option>
                            </select>
                        </div>

                        <!-- æ ‡ç­¾ -->
                        <div>
                            <label class="block text-sm font-medium mb-2" for="sub-requirement-tags">æ ‡ç­¾</label>
                            <input type="text" id="sub-requirement-tags" name="tags"
                                   class="w-full px-3 py-2 border border-border rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                                   placeholder="è¯·è¾“å…¥æ ‡ç­¾ï¼Œå¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”">
                        </div>
                    </form>
                </div>

                <!-- æ¨¡æ€æ¡†åº•éƒ¨ -->
                <div class="flex justify-end space-x-3 p-4 border-t border-border">
                    <button type="button" class="px-4 py-2 border border-border rounded-md hover:bg-accent" id="cancel-sub-requirement">
                        å–æ¶ˆ
                    </button>
                    <button type="submit" form="sub-requirement-form" class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/80">
                        ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åˆ†é…ç ”å‘ä»»åŠ¡å¼¹çª— -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="assign-task-modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card border border-border rounded-lg w-full max-w-4xl max-h-[90vh] overflow-hidden">
                <!-- å¼¹çª—å¤´éƒ¨ -->
                <div class="flex items-center justify-between p-4 border-b border-border">
                    <h3 class="text-lg font-semibold">åˆ†é…ç ”å‘ä»»åŠ¡</h3>
                    <button class="p-2 hover:bg-accent rounded-md" id="close-assign-modal">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>

                <!-- å¼¹çª—å†…å®¹ -->
                <div class="p-4 max-h-[60vh] overflow-y-auto">
                    <div class="space-y-4">
                        <!-- ä»»åŠ¡åŸºæœ¬ä¿¡æ¯ -->
                        <div class="bg-muted rounded-lg p-4">
                            <h4 class="font-medium text-base mb-3">ä»»åŠ¡åŸºæœ¬ä¿¡æ¯</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">ä»»åŠ¡åç§°</label>
                                    <input type="text" class="w-full px-3 py-2 border border-border rounded-md" id="task-name" placeholder="è¯·è¾“å…¥ä»»åŠ¡åç§°">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">è´Ÿè´£äºº</label>
                                    <select class="w-full px-3 py-2 border border-border rounded-md" id="task-assignee">
                                        <option value="">é€‰æ‹©è´Ÿè´£äºº</option>
                                        <option value="dev1">å¼ å¼€å‘</option>
                                        <option value="dev2">æç¨‹åº</option>
                                        <option value="dev3">ç‹å·¥ç¨‹å¸ˆ</option>
                                        <option value="dev4">èµµæ¶æ„</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">ä¼˜å…ˆçº§</label>
                                    <select class="w-full px-3 py-2 border border-border rounded-md" id="task-priority">
                                        <option value="high">ğŸ”´ é«˜ä¼˜å…ˆçº§</option>
                                        <option value="medium" selected>ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</option>
                                        <option value="low">ğŸŸ¢ ä½ä¼˜å…ˆçº§</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">é¢„æœŸå®Œæˆæ—¶é—´</label>
                                    <input type="date" class="w-full px-3 py-2 border border-border rounded-md" id="task-deadline">
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-sm font-medium mb-2">ä»»åŠ¡æè¿°</label>
                                <textarea class="w-full px-3 py-2 border border-border rounded-md resize-none" rows="3" id="task-description" placeholder="è¯·æè¿°ä»»åŠ¡çš„å…·ä½“è¦æ±‚å’Œç›®æ ‡..."></textarea>
                            </div>
                        </div>

                        <!-- é€‰æ‹©ç ”å‘éœ€æ±‚ -->
                        <div>
                            <h4 class="font-medium text-base mb-3">é€‰æ‹©ç ”å‘éœ€æ±‚</h4>
                            <div class="bg-card border border-border rounded-lg p-3">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-sm font-medium" id="selected-module-name">æ¨¡å—åç§°</span>
                                    <span class="text-xs text-muted-foreground">å·²é€‰æ‹© <span id="selected-count">0</span> ä¸ªéœ€æ±‚</span>
                                </div>
                                <div class="space-y-2" id="assignable-requirements">
                                    <!-- å¯åˆ†é…çš„ç ”å‘éœ€æ±‚åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å¼¹çª—åº•éƒ¨ -->
                <div class="flex items-center justify-between p-4 border-t border-border">
                    <div class="text-sm text-muted-foreground">
                        æ€»é¢„ä¼°å·¥æ—¶: <span id="total-workload">0å¤©</span>
                    </div>
                    <div class="flex space-x-3">
                        <button class="px-4 py-2 border border-border rounded-md hover:bg-accent text-sm" id="cancel-assign">
                            å–æ¶ˆ
                        </button>
                        <button class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-gray-800 text-sm font-medium" id="confirm-assign">
                            ç¡®è®¤åˆ†é…
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- äººå·¥æ‹†è§£å¼¹çª— -->
    <div class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden" id="manual-breakdown-modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-card border border-border rounded-lg w-full max-w-6xl max-h-[90vh] overflow-hidden">
                <!-- å¼¹çª—å¤´éƒ¨ -->
                <div class="flex items-center justify-between p-4 border-b border-border">
                    <h3 class="text-lg font-semibold">äººå·¥æ‹†è§£éœ€æ±‚</h3>
                    <button class="p-2 hover:bg-accent rounded-md" id="close-breakdown-modal">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>

                <!-- å¼¹çª—å†…å®¹ -->
                <div class="flex h-[70vh]">
                    <!-- å·¦ä¾§ï¼šåŸå§‹éœ€æ±‚ -->
                    <div class="w-1/2 p-4 border-r border-border overflow-y-auto">
                        <h4 class="font-medium text-base mb-3">åŸå§‹éœ€æ±‚</h4>
                        <div class="bg-muted rounded-lg p-4">
                            <h5 class="font-medium text-sm mb-2" id="original-requirement-title">éœ€æ±‚æ ‡é¢˜</h5>
                            <p class="text-sm text-muted-foreground mb-3" id="original-requirement-desc">éœ€æ±‚æè¿°å†…å®¹...</p>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 bg-primary text-primary-foreground text-xs rounded" id="original-requirement-category">åŠŸèƒ½éœ€æ±‚</span>
                                <span class="px-2 py-1 bg-warning text-warning-foreground text-xs rounded" id="original-requirement-priority">ğŸŸ¡ ä¸­ä¼˜å…ˆçº§</span>
                            </div>
                        </div>
                    </div>

                    <!-- å³ä¾§ï¼šæ‹†è§£åˆ—è¡¨ -->
                    <div class="w-1/2 p-4 overflow-y-auto">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-medium text-base">æ‹†è§£ç»“æœ</h4>
                            <button class="px-3 py-1.5 bg-primary text-primary-foreground rounded-md text-sm hover:bg-gray-800" id="add-breakdown-item">
                                + æ·»åŠ æ‹†è§£é¡¹
                            </button>
                        </div>

                        <!-- æ‹†è§£é¡¹åˆ—è¡¨ -->
                        <div class="space-y-3" id="breakdown-items-list">
                            <!-- æ‹†è§£é¡¹æ¨¡æ¿å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                        </div>
                    </div>
                </div>

                <!-- å¼¹çª—åº•éƒ¨ -->
                <div class="flex items-center justify-between p-4 border-t border-border">
                    <div class="text-sm text-muted-foreground">
                        å…± <span id="breakdown-count">0</span> ä¸ªæ‹†è§£é¡¹
                    </div>
                    <div class="flex space-x-3">
                        <button class="px-4 py-2 border border-border rounded-md hover:bg-accent text-sm" id="cancel-breakdown">
                            å–æ¶ˆ
                        </button>
                        <button class="px-4 py-2 bg-primary text-primary-foreground rounded-md hover:bg-gray-800 text-sm font-medium" id="save-breakdown">
                            ä¿å­˜æ‹†è§£
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥JavaScript -->
    <script src="../js/modules.js"></script>
    <script src="../js/requirement-management.js"></script>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½ -->
    <script>
        // äºŒçº§èœå•äº¤äº’åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            // å¤„ç†äºŒçº§èœå•å±•å¼€/æ”¶èµ·
            const navToggles = document.querySelectorAll('.nav-toggle');

            navToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                    e.preventDefault();

                    const targetId = this.dataset.target;
                    const submenu = document.getElementById(targetId);
                    const chevron = this.querySelector('.chevron-icon');

                    if (submenu) {
                        // åˆ‡æ¢å±•å¼€çŠ¶æ€
                        submenu.classList.toggle('expanded');
                        submenu.classList.toggle('hidden');
                        chevron.classList.toggle('rotated');
                    }
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
            // æ ‡ç­¾é¡µåˆ‡æ¢åŠŸèƒ½
            const tabButtons = document.querySelectorAll('[data-tab]');
            const tabContents = document.querySelectorAll('[data-tab-content]');

            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');

                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    tabButtons.forEach(btn => {
                        btn.classList.remove('border-primary', 'text-primary', 'font-medium');
                        btn.classList.add('border-transparent', 'text-muted-foreground');
                    });
                    this.classList.remove('border-transparent', 'text-muted-foreground');
                    this.classList.add('border-primary', 'text-primary', 'font-medium');

                    // æ›´æ–°å†…å®¹æ˜¾ç¤º
                    tabContents.forEach(content => {
                        if (content.getAttribute('data-tab-content') === targetTab) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });
                });
            });

            // éœ€æ±‚åˆ—è¡¨çŠ¶æ€åˆ‡æ¢åŠŸèƒ½
            const listFilterButtons = document.querySelectorAll('[data-list-filter]');
            const listContents = document.querySelectorAll('[data-list-content]');
            const countTexts = document.querySelectorAll('[data-count-text]');

            listFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetFilter = this.getAttribute('data-list-filter');

                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    listFilterButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-primary-foreground');
                        btn.classList.add('text-muted-foreground');
                    });
                    this.classList.remove('text-muted-foreground');
                    this.classList.add('bg-primary', 'text-primary-foreground');

                    // æ›´æ–°å†…å®¹æ˜¾ç¤º
                    listContents.forEach(content => {
                        if (content.getAttribute('data-list-content') === targetFilter) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });

                    // æ›´æ–°è®¡æ•°æ–‡æœ¬
                    countTexts.forEach(text => {
                        if (text.getAttribute('data-count-text') === targetFilter) {
                            text.classList.remove('hidden');
                        } else {
                            text.classList.add('hidden');
                        }
                    });
                });
            });

            // ç ”å‘éœ€æ±‚çŠ¶æ€åˆ‡æ¢åŠŸèƒ½
            const devFilterButtons = document.querySelectorAll('[data-dev-filter]');
            const devContents = document.querySelectorAll('[data-dev-content]');
            const devCountTexts = document.querySelectorAll('[data-dev-count-text]');

            devFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetFilter = this.getAttribute('data-dev-filter');

                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    devFilterButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-primary-foreground');
                        btn.classList.add('text-muted-foreground');
                    });
                    this.classList.remove('text-muted-foreground');
                    this.classList.add('bg-primary', 'text-primary-foreground');

                    // æ›´æ–°å†…å®¹æ˜¾ç¤º
                    devContents.forEach(content => {
                        if (content.getAttribute('data-dev-content') === targetFilter) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });

                    // æ›´æ–°è®¡æ•°æ–‡æœ¬
                    devCountTexts.forEach(text => {
                        if (text.getAttribute('data-dev-count-text') === targetFilter) {
                            text.classList.remove('hidden');
                        } else {
                            text.classList.add('hidden');
                        }
                    });
                });
            });

            // æ‹†è§£åŠŸèƒ½äº¤äº’
            const breakdownButtons = document.querySelectorAll('[data-action="breakdown-requirement"]');

            breakdownButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const requirementId = this.getAttribute('data-requirement-id');
                    const menu = document.querySelector(`[data-breakdown-menu="${requirementId}"]`);

                    // éšè—æ‰€æœ‰å…¶ä»–èœå•
                    document.querySelectorAll('[data-breakdown-menu]').forEach(m => {
                        if (m !== menu) m.classList.add('hidden');
                    });

                    // åˆ‡æ¢å½“å‰èœå•
                    menu.classList.toggle('hidden');
                });
            });

            // AIæ‹†è§£å’Œäººå·¥æ‹†è§£åŠŸèƒ½
            document.addEventListener('click', function(e) {
                if (e.target.matches('[data-action="ai-breakdown"]')) {
                    const requirementId = e.target.getAttribute('data-requirement-id');
                    alert(`å¼€å§‹AIæ‹†è§£éœ€æ±‚: ${requirementId}`);
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„AIæ‹†è§£é€»è¾‘
                } else if (e.target.matches('[data-action="manual-breakdown"]')) {
                    const requirementId = e.target.getAttribute('data-requirement-id');
                    openManualBreakdownModal(requirementId);
                }

                // ç‚¹å‡»å…¶ä»–åœ°æ–¹æ—¶éšè—æ‰€æœ‰æ‹†è§£èœå•
                if (!e.target.closest('[data-breakdown-menu]') && !e.target.matches('[data-action="breakdown-requirement"]')) {
                    document.querySelectorAll('[data-breakdown-menu]').forEach(menu => {
                        menu.classList.add('hidden');
                    });
                }
            });

            // äººå·¥æ‹†è§£å¼¹çª—åŠŸèƒ½
            let currentRequirementId = null;
            let breakdownItemCounter = 0;

            function openManualBreakdownModal(requirementId) {
                currentRequirementId = requirementId;
                const modal = document.getElementById('manual-breakdown-modal');

                // æ ¹æ®éœ€æ±‚IDè·å–éœ€æ±‚ä¿¡æ¯ï¼ˆè¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼‰
                const requirementData = getRequirementData(requirementId);

                // å¡«å……åŸå§‹éœ€æ±‚ä¿¡æ¯
                document.getElementById('original-requirement-title').textContent = requirementData.title;
                document.getElementById('original-requirement-desc').textContent = requirementData.description;
                document.getElementById('original-requirement-category').textContent = requirementData.category;
                document.getElementById('original-requirement-priority').textContent = requirementData.priority;

                // æ¸…ç©ºæ‹†è§£åˆ—è¡¨
                document.getElementById('breakdown-items-list').innerHTML = '';
                breakdownItemCounter = 0;
                updateBreakdownCount();

                // æ˜¾ç¤ºå¼¹çª—
                modal.classList.remove('hidden');

                // éšè—æ‹†è§£èœå•
                document.querySelectorAll('[data-breakdown-menu]').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }

            function getRequirementData(requirementId) {
                // æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”è¯¥ä»æ•°æ®æºè·å–
                const mockData = {
                    'req-002': {
                        title: 'æ”¯ä»˜åŠŸèƒ½å¢å¼º',
                        description: 'éœ€è¦å¢åŠ å¤šç§æ”¯ä»˜æ–¹å¼ï¼ŒåŒ…æ‹¬å¾®ä¿¡ã€æ”¯ä»˜å®ã€é“¶è”ç­‰ï¼Œæå‡ç”¨æˆ·æ”¯ä»˜ä½“éªŒå’Œå®‰å…¨æ€§ã€‚',
                        category: 'åŠŸèƒ½éœ€æ±‚',
                        priority: 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§'
                    },
                    'req-004': {
                        title: 'ç§»åŠ¨ç«¯é€‚é…',
                        description: 'ç³»ç»Ÿéœ€è¦æ”¯æŒç§»åŠ¨ç«¯è®¿é—®ï¼Œå“åº”å¼è®¾è®¡ï¼Œä¼˜åŒ–è§¦æ‘¸äº¤äº’ä½“éªŒã€‚',
                        category: 'ç•Œé¢éœ€æ±‚',
                        priority: 'ğŸŸ¢ ä½ä¼˜å…ˆçº§'
                    }
                };
                return mockData[requirementId] || {
                    title: 'æœªçŸ¥éœ€æ±‚',
                    description: 'éœ€æ±‚æè¿°ä¸å¯ç”¨',
                    category: 'åŠŸèƒ½éœ€æ±‚',
                    priority: 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§'
                };
            }

            function addBreakdownItem() {
                breakdownItemCounter++;
                const itemId = `breakdown-item-${breakdownItemCounter}`;
                const itemHtml = `
                    <div class="border border-border rounded-lg p-3" data-breakdown-item="${itemId}">
                        <div class="flex items-start justify-between mb-3">
                            <h5 class="font-medium text-sm">æ‹†è§£é¡¹ ${breakdownItemCounter}</h5>
                            <button class="text-muted-foreground hover:text-destructive" onclick="removeBreakdownItem('${itemId}')">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs font-medium mb-1">æ‹†è§£ç»“æœ</label>
                                <textarea class="w-full px-3 py-2 border border-border rounded-md text-sm resize-none" rows="2" placeholder="è¯·æè¿°æ‹†è§£åçš„å…·ä½“éœ€æ±‚..."></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-xs font-medium mb-1">æ‰€å±æ¨¡å—</label>
                                    <select class="w-full px-3 py-2 border border-border rounded-md text-sm">
                                        <option value="">é€‰æ‹©æ¨¡å—</option>
                                        <option value="frontend">å‰ç«¯æ¨¡å—</option>
                                        <option value="backend">åç«¯æ¨¡å—</option>
                                        <option value="payment">æ”¯ä»˜æ¨¡å—</option>
                                        <option value="user">ç”¨æˆ·æ¨¡å—</option>
                                        <option value="admin">ç®¡ç†æ¨¡å—</option>
                                        <option value="api">APIæ¨¡å—</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-medium mb-1">éœ€æ±‚ç­‰çº§</label>
                                    <select class="w-full px-3 py-2 border border-border rounded-md text-sm">
                                        <option value="high">ğŸ”´ é«˜ç­‰çº§</option>
                                        <option value="medium" selected>ğŸŸ¡ ä¸­ç­‰çº§</option>
                                        <option value="low">ğŸŸ¢ ä½ç­‰çº§</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium mb-1">é¢„ä¼°å·¥æ—¶</label>
                                <input type="text" class="w-full px-3 py-2 border border-border rounded-md text-sm" placeholder="å¦‚ï¼š3å¤©">
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('breakdown-items-list').insertAdjacentHTML('beforeend', itemHtml);
                updateBreakdownCount();
            }

            function removeBreakdownItem(itemId) {
                const item = document.querySelector(`[data-breakdown-item="${itemId}"]`);
                if (item) {
                    item.remove();
                    updateBreakdownCount();
                }
            }

            function updateBreakdownCount() {
                const count = document.querySelectorAll('[data-breakdown-item]').length;
                document.getElementById('breakdown-count').textContent = count;
            }

            function closeManualBreakdownModal() {
                document.getElementById('manual-breakdown-modal').classList.add('hidden');
                currentRequirementId = null;
            }

            function saveBreakdown() {
                const breakdownItems = [];
                document.querySelectorAll('[data-breakdown-item]').forEach(item => {
                    const description = item.querySelector('textarea').value;
                    const module = item.querySelector('select:nth-of-type(1)').value;
                    const level = item.querySelector('select:nth-of-type(2)').value;
                    const workload = item.querySelector('input[type="text"]').value;

                    if (description.trim()) {
                        breakdownItems.push({
                            description: description.trim(),
                            module: module,
                            level: level,
                            workload: workload
                        });
                    }
                });

                if (breakdownItems.length === 0) {
                    alert('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªæ‹†è§£é¡¹');
                    return;
                }

                // è¿™é‡Œå¯ä»¥æ·»åŠ ä¿å­˜é€»è¾‘
                console.log('ä¿å­˜æ‹†è§£ç»“æœ:', {
                    requirementId: currentRequirementId,
                    items: breakdownItems
                });

                alert(`æˆåŠŸæ‹†è§£éœ€æ±‚ï¼Œå…±ç”Ÿæˆ ${breakdownItems.length} ä¸ªç ”å‘éœ€æ±‚`);
                closeManualBreakdownModal();
            }

            // åˆ†é…ç ”å‘ä»»åŠ¡åŠŸèƒ½
            let currentModule = null;

            function openAssignTaskModal(module) {
                currentModule = module;
                const modal = document.getElementById('assign-task-modal');

                // è·å–æ¨¡å—ä¿¡æ¯
                const moduleData = getModuleData(module);
                document.getElementById('selected-module-name').textContent = moduleData.name;
                document.getElementById('task-name').value = `${moduleData.name}å¼€å‘ä»»åŠ¡`;

                // ç”Ÿæˆå¯åˆ†é…çš„ç ”å‘éœ€æ±‚åˆ—è¡¨
                generateAssignableRequirements(moduleData.requirements);

                // æ˜¾ç¤ºå¼¹çª—
                modal.classList.remove('hidden');
                updateSelectedCount();
            }

            function getModuleData(module) {
                const moduleMap = {
                    'frontend': {
                        name: 'å‰ç«¯æ¨¡å—',
                        requirements: [
                            { id: 'frontend-responsive', name: 'å“åº”å¼å¸ƒå±€ä¼˜åŒ–', desc: 'ä¼˜åŒ–é¡µé¢å¸ƒå±€ï¼Œé€‚é…ç§»åŠ¨ç«¯å±å¹•', workload: '2å¤©' },
                            { id: 'frontend-interaction', name: 'ç§»åŠ¨ç«¯äº¤äº’ä¼˜åŒ–', desc: 'ä¼˜åŒ–è§¦æ‘¸äº¤äº’ï¼Œæå‡ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒ', workload: '3å¤©' }
                        ]
                    },
                    'payment': {
                        name: 'æ”¯ä»˜æ¨¡å—',
                        requirements: [
                            { id: 'payment-wechat', name: 'å¾®ä¿¡æ”¯ä»˜é›†æˆ', desc: 'é›†æˆå¾®ä¿¡æ”¯ä»˜SDKï¼Œå®ç°æ”¯ä»˜ã€é€€æ¬¾åŠŸèƒ½', workload: '3å¤©' },
                            { id: 'payment-alipay', name: 'æ”¯ä»˜å®æ”¯ä»˜é›†æˆ', desc: 'é›†æˆæ”¯ä»˜å®SDKï¼Œå®ç°æ”¯ä»˜ã€é€€æ¬¾åŠŸèƒ½', workload: '3å¤©' }
                        ]
                    }
                };
                return moduleMap[module] || { name: 'æœªçŸ¥æ¨¡å—', requirements: [] };
            }

            function generateAssignableRequirements(requirements) {
                const container = document.getElementById('assignable-requirements');
                container.innerHTML = '';

                requirements.forEach(req => {
                    const reqHtml = `
                        <div class="flex items-start space-x-3 p-2 border border-border rounded">
                            <input type="checkbox" class="mt-1" data-requirement="${req.id}" data-workload="${req.workload}" onchange="updateSelectedCount()">
                            <div class="flex-1">
                                <h5 class="font-medium text-sm">${req.name}</h5>
                                <p class="text-xs text-muted-foreground mt-1">${req.desc}</p>
                                <span class="text-xs text-muted-foreground">é¢„ä¼°: ${req.workload}</span>
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', reqHtml);
                });
            }

            function updateSelectedCount() {
                const checkboxes = document.querySelectorAll('#assignable-requirements input[type="checkbox"]:checked');
                document.getElementById('selected-count').textContent = checkboxes.length;

                // è®¡ç®—æ€»å·¥æ—¶
                let totalDays = 0;
                checkboxes.forEach(cb => {
                    const workload = cb.getAttribute('data-workload');
                    const days = parseInt(workload.replace('å¤©', '')) || 0;
                    totalDays += days;
                });
                document.getElementById('total-workload').textContent = `${totalDays}å¤©`;
            }

            function closeAssignTaskModal() {
                document.getElementById('assign-task-modal').classList.add('hidden');
                currentModule = null;
            }

            function confirmAssignTask() {
                const taskName = document.getElementById('task-name').value.trim();
                const assignee = document.getElementById('task-assignee').value;
                const priority = document.getElementById('task-priority').value;
                const deadline = document.getElementById('task-deadline').value;
                const description = document.getElementById('task-description').value.trim();

                const selectedRequirements = [];
                document.querySelectorAll('#assignable-requirements input[type="checkbox"]:checked').forEach(cb => {
                    selectedRequirements.push(cb.getAttribute('data-requirement'));
                });

                if (!taskName) {
                    alert('è¯·è¾“å…¥ä»»åŠ¡åç§°');
                    return;
                }

                if (!assignee) {
                    alert('è¯·é€‰æ‹©è´Ÿè´£äºº');
                    return;
                }

                if (selectedRequirements.length === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç ”å‘éœ€æ±‚');
                    return;
                }

                // è¿™é‡Œå¯ä»¥æ·»åŠ ä¿å­˜é€»è¾‘
                console.log('åˆ†é…ç ”å‘ä»»åŠ¡:', {
                    taskName,
                    assignee,
                    priority,
                    deadline,
                    description,
                    module: currentModule,
                    requirements: selectedRequirements
                });

                alert(`æˆåŠŸåˆ†é…ç ”å‘ä»»åŠ¡"${taskName}"ç»™${getAssigneeName(assignee)}`);
                closeAssignTaskModal();
            }

            function getAssigneeName(assigneeId) {
                const assigneeMap = {
                    'dev1': 'å¼ å¼€å‘',
                    'dev2': 'æç¨‹åº',
                    'dev3': 'ç‹å·¥ç¨‹å¸ˆ',
                    'dev4': 'èµµæ¶æ„'
                };
                return assigneeMap[assigneeId] || 'æœªçŸ¥å¼€å‘è€…';
            }

            // åˆ†é…ä»»åŠ¡äº‹ä»¶ç›‘å¬
            document.addEventListener('click', function(e) {
                if (e.target.matches('[data-action="assign-dev-task"]')) {
                    const module = e.target.getAttribute('data-module');
                    openAssignTaskModal(module);
                }
            });

            document.getElementById('close-assign-modal').addEventListener('click', closeAssignTaskModal);
            document.getElementById('cancel-assign').addEventListener('click', closeAssignTaskModal);
            document.getElementById('confirm-assign').addEventListener('click', confirmAssignTask);

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            document.getElementById('assign-task-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAssignTaskModal();
                }
            });

            // å¼¹çª—äº‹ä»¶ç›‘å¬
            document.getElementById('add-breakdown-item').addEventListener('click', addBreakdownItem);
            document.getElementById('close-breakdown-modal').addEventListener('click', closeManualBreakdownModal);
            document.getElementById('cancel-breakdown').addEventListener('click', closeManualBreakdownModal);
            document.getElementById('save-breakdown').addEventListener('click', saveBreakdown);

            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            document.getElementById('manual-breakdown-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeManualBreakdownModal();
                }
            });

            // éœ€æ±‚åˆ†ç±»æŒ‰é’®åˆ‡æ¢
            const categoryButtons = document.querySelectorAll('[data-category]');
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    categoryButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-primary-foreground');
                        btn.classList.add('bg-muted', 'text-muted-foreground');
                    });
                    this.classList.remove('bg-muted', 'text-muted-foreground');
                    this.classList.add('bg-primary', 'text-primary-foreground');
                });
            });

            // éœ€æ±‚å®¡æ‰¹é¡µé¢ç­›é€‰åŠŸèƒ½
            const approvalProjectFilter = document.getElementById('approval-project-filter');
            const approvalSourceFilter = document.getElementById('approval-source-filter');
            const categoryFilterButtons = document.querySelectorAll('[data-category-filter]');

            // ç­›é€‰å™¨å˜æ›´äº‹ä»¶
            if (approvalProjectFilter) {
                approvalProjectFilter.addEventListener('change', filterRequirements);
            }
            if (approvalSourceFilter) {
                approvalSourceFilter.addEventListener('change', filterRequirements);
            }

            // åˆ†ç±»ç­›é€‰æŒ‰é’®äº‹ä»¶
            categoryFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    categoryFilterButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-primary-foreground');
                        btn.classList.add('bg-muted', 'text-muted-foreground');
                    });
                    this.classList.remove('bg-muted', 'text-muted-foreground');
                    this.classList.add('bg-primary', 'text-primary-foreground');

                    // æ‰§è¡Œç­›é€‰
                    filterRequirements();
                });
            });

            // ç­›é€‰éœ€æ±‚å‡½æ•°
            function filterRequirements() {
                const projectFilter = approvalProjectFilter ? approvalProjectFilter.value : '';
                const sourceFilter = approvalSourceFilter ? approvalSourceFilter.value : '';
                const categoryFilter = document.querySelector('[data-category-filter].bg-primary')?.dataset.categoryFilter || 'all';

                // è·å–å½“å‰æ˜¾ç¤ºçš„éœ€æ±‚åˆ—è¡¨
                const currentContent = document.querySelector('[data-approval-content]:not(.hidden)');
                if (!currentContent) return;

                const requirements = currentContent.querySelectorAll('[data-requirement-id]');
                let visibleCount = 0;

                requirements.forEach(requirement => {
                    const projectMatch = !projectFilter || requirement.dataset.project === projectFilter;
                    const sourceMatch = !sourceFilter || requirement.dataset.source === sourceFilter;
                    const categoryMatch = categoryFilter === 'all' || requirement.dataset.category === categoryFilter;

                    if (projectMatch && sourceMatch && categoryMatch) {
                        requirement.style.display = '';
                        visibleCount++;
                    } else {
                        requirement.style.display = 'none';
                    }
                });

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateFilteredCount(visibleCount);
            }

            // æ›´æ–°ç­›é€‰åçš„ç»Ÿè®¡ä¿¡æ¯
            function updateFilteredCount(count) {
                const currentCountText = document.querySelector('[data-approval-count-text]:not(.hidden)');
                if (currentCountText) {
                    const isApproved = currentCountText.dataset.approvalCountText === 'approved';
                    const text = isApproved ? `å…± ${count} ä¸ªå·²å®¡æ‰¹éœ€æ±‚` : `å…± ${count} ä¸ªå¾…å®¡æ‰¹éœ€æ±‚`;
                    currentCountText.textContent = text;
                }
            }

            // é‡ç½®ç­›é€‰å™¨
            function resetFilters() {
                if (approvalProjectFilter) approvalProjectFilter.value = '';
                if (approvalSourceFilter) approvalSourceFilter.value = '';

                // é‡ç½®åˆ†ç±»ç­›é€‰æŒ‰é’®
                categoryFilterButtons.forEach(btn => {
                    btn.classList.remove('bg-primary', 'text-primary-foreground');
                    btn.classList.add('bg-muted', 'text-muted-foreground');
                });
                const allButton = document.querySelector('[data-category-filter="all"]');
                if (allButton) {
                    allButton.classList.remove('bg-muted', 'text-muted-foreground');
                    allButton.classList.add('bg-primary', 'text-primary-foreground');
                }

                filterRequirements();
            }

            // å®¡æ‰¹çŠ¶æ€åˆ‡æ¢æ—¶é‡ç½®ç­›é€‰å™¨
            const originalApprovalFilterButtons = document.querySelectorAll('[data-approval-filter]');
            originalApprovalFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    setTimeout(() => {
                        resetFilters();
                    }, 100);
                });
            });

            // EasyMDE Markdownç¼–è¾‘å™¨åˆå§‹åŒ–
            let easyMDE = null;

            // åˆå§‹åŒ–EasyMDEç¼–è¾‘å™¨
            function initializeMarkdownEditor() {
                const textarea = document.getElementById('requirement-description');
                if (!textarea || easyMDE) return;

                easyMDE = new EasyMDE({
                    element: textarea,
                    placeholder: 'è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚...',
                    spellChecker: false,
                    autofocus: false,
                    minHeight: '400px',
                    maxHeight: '600px',
                    toolbar: [
                        'bold',
                        'italic',
                        'strikethrough',
                        'heading',
                        '|',
                        'quote',
                        'unordered-list',
                        'ordered-list',
                        'clean-block',
                        '|',
                        'link',
                        'image',
                        'table',
                        'horizontal-rule',
                        '|',
                        'code',
                        'preview',
                        'side-by-side',
                        'fullscreen',
                        '|',
                        'undo',
                        'redo',
                        '|',
                        'guide'
                    ],
                    shortcuts: {
                        'toggleBold': 'Cmd-B',
                        'toggleItalic': 'Cmd-I',
                        'toggleStrikethrough': 'Cmd-Alt-S',
                        'toggleCodeBlock': 'Cmd-Alt-C',
                        'togglePreview': 'Cmd-P',
                        'toggleSideBySide': 'F9',
                        'toggleFullScreen': 'F11'
                    },
                    status: false, // ç¦ç”¨åº•éƒ¨çŠ¶æ€æ ï¼Œæˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰çš„
                    renderingConfig: {
                        singleLineBreaks: false,
                        codeSyntaxHighlighting: true
                    },
                    previewRender: function(plainText) {
                        // è‡ªå®šä¹‰é¢„è§ˆæ¸²æŸ“
                        return this.parent.markdown(plainText);
                    },
                    tabSize: 4,
                    indentWithTabs: false,
                    lineWrapping: true,
                    autoDownloadFontAwesome: false
                });

                // ç›‘å¬å†…å®¹å˜åŒ–ï¼Œæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                easyMDE.codemirror.on('change', function() {
                    updateWordCount();
                    autoSave();
                });

                // åŠ è½½è‰ç¨¿
                loadDraft();

                // è®¾ç½®å®šæ—¶è‡ªåŠ¨ä¿å­˜
                setInterval(autoSave, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
            }

            // æ›´æ–°å­—ç¬¦å’Œå•è¯ç»Ÿè®¡
            function updateWordCount() {
                if (!easyMDE) return;

                const content = easyMDE.value();
                const charCount = content.length;
                const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;

                const charCountEl = document.getElementById('char-count');
                const wordCountEl = document.getElementById('word-count');

                if (charCountEl) charCountEl.textContent = `å­—ç¬¦æ•°: ${charCount}`;
                if (wordCountEl) wordCountEl.textContent = `å•è¯æ•°: ${wordCount}`;
            }

            // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
            function autoSave() {
                if (!easyMDE) return;

                const content = easyMDE.value();
                if (content) {
                    localStorage.setItem('requirement-draft', content);
                }
            }

            // åŠ è½½è‰ç¨¿
            function loadDraft() {
                const draft = localStorage.getItem('requirement-draft');
                if (draft && easyMDE) {
                    easyMDE.value(draft);
                    updateWordCount();
                }
            }

            // æ¸…é™¤è‰ç¨¿
            function clearDraft() {
                localStorage.removeItem('requirement-draft');
            }

            // å¯¼å‡ºå†…å®¹
            function exportContent() {
                if (!easyMDE) return;

                const content = easyMDE.value();
                const blob = new Blob([content], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'éœ€æ±‚æè¿°.md';
                a.click();
                URL.revokeObjectURL(url);
            }

            // Markdownè¯­æ³•å¸®åŠ©
            function showMarkdownHelp() {
                const helpContent = `
# Markdownè¯­æ³•å¸®åŠ©

## æ ‡é¢˜
# ä¸€çº§æ ‡é¢˜
## äºŒçº§æ ‡é¢˜
### ä¸‰çº§æ ‡é¢˜

## æ–‡æœ¬æ ¼å¼
**ç²—ä½“æ–‡æœ¬**
*æ–œä½“æ–‡æœ¬*
~~åˆ é™¤çº¿~~
\`è¡Œå†…ä»£ç \`

## åˆ—è¡¨
- æ— åºåˆ—è¡¨é¡¹1
- æ— åºåˆ—è¡¨é¡¹2

1. æœ‰åºåˆ—è¡¨é¡¹1
2. æœ‰åºåˆ—è¡¨é¡¹2

## ä»»åŠ¡åˆ—è¡¨
- [ ] æœªå®Œæˆä»»åŠ¡
- [x] å·²å®Œæˆä»»åŠ¡

## é“¾æ¥å’Œå›¾ç‰‡
[é“¾æ¥æ–‡æœ¬](URL)
![å›¾ç‰‡æè¿°](å›¾ç‰‡URL)

## è¡¨æ ¼
| åˆ—1 | åˆ—2 | åˆ—3 |
|-----|-----|-----|
| å†…å®¹1 | å†…å®¹2 | å†…å®¹3 |

## ä»£ç å—
\`\`\`javascript
function hello() {
    console.log('Hello World!');
}
\`\`\`

## å¼•ç”¨
> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨æ–‡æœ¬

## å¿«æ·é”®
- Ctrl/Cmd + B: ç²—ä½“
- Ctrl/Cmd + I: æ–œä½“
- Ctrl/Cmd + P: é¢„è§ˆ
- F9: åˆ†å±é¢„è§ˆ
- F11: å…¨å±
                `;

                alert(helpContent);
            }

            // åœ¨éœ€æ±‚å½•å…¥æ ‡ç­¾é¡µæ¿€æ´»æ—¶åˆå§‹åŒ–ç¼–è¾‘å™¨
            document.addEventListener('DOMContentLoaded', function() {
                // ç›‘å¬æ ‡ç­¾é¡µåˆ‡æ¢
                const tabButtons = document.querySelectorAll('[data-tab]');
                tabButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const tabName = this.dataset.tab;
                        if (tabName === 'requirement-entry') {
                            // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
                            setTimeout(initializeMarkdownEditor, 100);
                        }
                    });
                });

                // å¦‚æœé»˜è®¤æ˜¾ç¤ºéœ€æ±‚å½•å…¥é¡µé¢ï¼Œç«‹å³åˆå§‹åŒ–
                const activeTab = document.querySelector('[data-tab-content="requirement-entry"]:not(.hidden)');
                if (activeTab) {
                    setTimeout(initializeMarkdownEditor, 100);
                }
            });

            // ä¼˜å…ˆçº§æŒ‰é’®åˆ‡æ¢
            const priorityButtons = document.querySelectorAll('[data-priority]');
            priorityButtons.forEach(button => {
                button.addEventListener('click', function() {
                    priorityButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-primary-foreground');
                        if (btn.getAttribute('data-priority') === 'medium') {
                            btn.classList.add('bg-warning', 'text-warning-foreground');
                        } else {
                            btn.classList.add('bg-muted', 'text-muted-foreground');
                        }
                    });

                    if (this.getAttribute('data-priority') === 'medium') {
                        this.classList.remove('bg-warning', 'text-warning-foreground');
                    } else {
                        this.classList.remove('bg-muted', 'text-muted-foreground');
                    }
                    this.classList.add('bg-primary', 'text-primary-foreground');
                });
            });

            // å®¢æˆ·ä¿¡æ¯é¢æ¿æŠ˜å å±•å¼€åŠŸèƒ½
            const toggleButtons = document.querySelectorAll('[data-toggle]');
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-toggle');
                    const content = document.querySelector(`[data-content="${targetId}"]`);
                    const chevron = document.querySelector(`[data-chevron="${targetId}"] svg`);

                    if (content && chevron) {
                        content.classList.toggle('hidden');

                        // æ—‹è½¬ç®­å¤´
                        if (content.classList.contains('hidden')) {
                            chevron.style.transform = 'rotate(0deg)';
                        } else {
                            chevron.style.transform = 'rotate(180deg)';
                        }
                    }
                });
            });

            // éœ€æ±‚å®¡æ‰¹Button Groupåˆ‡æ¢åŠŸèƒ½
            const approvalFilterButtons = document.querySelectorAll('[data-approval-filter]');
            const approvalContents = document.querySelectorAll('[data-approval-content]');
            const approvalCountTexts = document.querySelectorAll('[data-approval-count-text]');

            approvalFilterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const filter = this.dataset.approvalFilter;

                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    approvalFilterButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-primary-foreground');
                        btn.classList.add('text-muted-foreground', 'hover:text-foreground');
                    });
                    this.classList.remove('text-muted-foreground', 'hover:text-foreground');
                    this.classList.add('bg-primary', 'text-primary-foreground');

                    // æ›´æ–°å†…å®¹æ˜¾ç¤º
                    approvalContents.forEach(content => {
                        if (content.dataset.approvalContent === filter) {
                            content.classList.remove('hidden');
                        } else {
                            content.classList.add('hidden');
                        }
                    });

                    // æ›´æ–°ç»Ÿè®¡æ–‡æœ¬
                    approvalCountTexts.forEach(text => {
                        if (text.dataset.approvalCountText === filter) {
                            text.classList.remove('hidden');
                        } else {
                            text.classList.add('hidden');
                        }
                    });
                });
            });

            // éœ€æ±‚æ‹†åˆ†åŠŸèƒ½
            let currentSelectedRequirement = 'req-004'; // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªéœ€æ±‚

            // éœ€æ±‚é¡¹é€‰ä¸­åŠŸèƒ½ - åªå¤„ç†éœ€æ±‚é¡¹çš„ä¸»è¦å†…å®¹åŒºåŸŸç‚¹å‡»
            function selectRequirement(requirementId, requirementName) {
                console.log('é€‰ä¸­éœ€æ±‚:', requirementId, requirementName); // è°ƒè¯•ä¿¡æ¯

                // ç§»é™¤å…¶ä»–é¡¹çš„activeçŠ¶æ€
                document.querySelectorAll('.requirement-item').forEach(i => i.classList.remove('active'));
                // æ·»åŠ å½“å‰é¡¹çš„activeçŠ¶æ€
                document.querySelector(`[data-requirement-id="${requirementId}"]`).classList.add('active');

                // æ›´æ–°é€‰ä¸­çš„éœ€æ±‚
                currentSelectedRequirement = requirementId;

                // æ›´æ–°å³ä¾§é¢æ¿çš„éœ€æ±‚ä¿¡æ¯
                updateSelectedRequirementInfo(requirementId, requirementName);

                // åŠ è½½å¯¹åº”çš„å­éœ€æ±‚åˆ—è¡¨
                loadSubRequirements(requirementId);
            }

            // éœ€æ±‚é¡¹ç‚¹å‡»äº‹ä»¶ï¼ˆä»…é€‰ä¸­ï¼Œä¸å±•ç¤ºè¯¦æƒ…ï¼‰
            document.querySelectorAll('.requirement-item').forEach(item => {
                // ä¸ºéœ€æ±‚é¡¹çš„ä¸»è¦å†…å®¹åŒºåŸŸæ·»åŠ ç‚¹å‡»äº‹ä»¶
                const mainContent = item.querySelector('.flex-1');
                if (mainContent) {
                    mainContent.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const requirementId = item.dataset.requirementId;
                        const requirementName = item.dataset.requirementName;
                        selectRequirement(requirementId, requirementName);
                    });
                }
            });

            // æŸ¥çœ‹éœ€æ±‚è¯¦æƒ…æŒ‰é’®äº‹ä»¶ - ä½¿ç”¨æ›´ç²¾ç¡®çš„äº‹ä»¶ç»‘å®š
            document.querySelectorAll('[data-action="view-requirement-detail"]').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°çˆ¶å…ƒç´ 
                    e.preventDefault();  // é˜»æ­¢é»˜è®¤è¡Œä¸º

                    const requirementId = this.dataset.requirementId;
                    console.log('æŸ¥çœ‹éœ€æ±‚è¯¦æƒ…:', requirementId); // è°ƒè¯•ä¿¡æ¯
                    showRequirementDetail(requirementId);
                });
            });

            // æ›´æ–°é€‰ä¸­éœ€æ±‚ä¿¡æ¯
            function updateSelectedRequirementInfo(requirementId, requirementName) {
                const requirementData = getRequirementDetailData(requirementId);
                document.getElementById('selected-requirement-name').textContent = requirementName;
                document.getElementById('selected-requirement-desc').textContent = requirementData.description;
            }

            // è·å–éœ€æ±‚è¯¦ç»†æ•°æ®
            function getRequirementDetailData(requirementId) {
                const mockData = {
                    'req-004': {
                        name: 'ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ',
                        description: 'å®Œå–„ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒè§’è‰²åˆ†é…å’Œæƒé™æ§åˆ¶ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§å’Œç®¡ç†æ•ˆç‡ã€‚',
                        submitter: 'èµµç®¡ç†å‘˜',
                        approvalTime: '2024-01-17 15:30',
                        type: 'åŠŸèƒ½éœ€æ±‚',
                        priority: 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§',
                        background: 'éšç€ç³»ç»Ÿç”¨æˆ·æ•°é‡å¢é•¿ï¼Œéœ€è¦å»ºç«‹å®Œå–„çš„æƒé™ç®¡ç†ä½“ç³»ï¼Œç¡®ä¿ä¸åŒè§’è‰²ç”¨æˆ·åªèƒ½è®¿é—®ç›¸åº”çš„åŠŸèƒ½æ¨¡å—ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§ã€‚',
                        acceptanceCriteria: [
                            'æ”¯æŒåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç”¨æˆ·è§’è‰²',
                            'å®ç°èœå•æƒé™ã€æ“ä½œæƒé™ã€æ•°æ®æƒé™æ§åˆ¶',
                            'æä¾›ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒè§’è‰²åˆ†é…',
                            'æƒé™å˜æ›´å®æ—¶ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°ç™»å½•'
                        ]
                    },
                    'req-005': {
                        name: 'ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–',
                        description: 'ä¼˜åŒ–ç§»åŠ¨ç«¯é¡µé¢é€‚é…ï¼Œæå‡ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒï¼Œæ”¯æŒå“åº”å¼å¸ƒå±€å’Œè§¦æ‘¸æ“ä½œã€‚',
                        submitter: 'é™ˆå‰ç«¯',
                        approvalTime: '2024-01-16 11:45',
                        type: 'ä¼˜åŒ–éœ€æ±‚',
                        priority: 'ğŸŸ¢ ä½ä¼˜å…ˆçº§',
                        background: 'éšç€ç§»åŠ¨ç«¯ç”¨æˆ·å¢é•¿ï¼Œç°æœ‰ç³»ç»Ÿåœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„ä½“éªŒä¸ä½³ï¼Œéœ€è¦è¿›è¡Œä¸“é—¨çš„ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–ã€‚',
                        acceptanceCriteria: [
                            'æ”¯æŒä¸»æµç§»åŠ¨è®¾å¤‡å±å¹•é€‚é…',
                            'ä¼˜åŒ–è§¦æ‘¸äº¤äº’ä½“éªŒ',
                            'æå‡ç§»åŠ¨ç«¯é¡µé¢åŠ è½½é€Ÿåº¦',
                            'ç¡®ä¿æ ¸å¿ƒåŠŸèƒ½åœ¨ç§»åŠ¨ç«¯æ­£å¸¸ä½¿ç”¨'
                        ]
                    }
                };
                return mockData[requirementId] || {
                    name: 'æœªçŸ¥éœ€æ±‚',
                    description: 'éœ€æ±‚æè¿°ä¸å¯ç”¨',
                    submitter: 'æœªçŸ¥',
                    approvalTime: 'æœªçŸ¥',
                    type: 'åŠŸèƒ½éœ€æ±‚',
                    priority: 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§',
                    background: 'æš‚æ— èƒŒæ™¯ä¿¡æ¯',
                    acceptanceCriteria: []
                };
            }

            // æ˜¾ç¤ºéœ€æ±‚è¯¦æƒ…
            function showRequirementDetail(requirementId) {
                const requirementData = getRequirementDetailData(requirementId);
                const subRequirementsData = getSubRequirementsData(requirementId);

                // å¡«å……åŸºæœ¬ä¿¡æ¯
                document.getElementById('detail-requirement-name').textContent = requirementData.name;
                document.getElementById('detail-submitter').textContent = requirementData.submitter;
                document.getElementById('detail-approval-time').textContent = requirementData.approvalTime;
                document.getElementById('detail-requirement-type').textContent = requirementData.type;
                document.getElementById('detail-priority').textContent = requirementData.priority;
                document.getElementById('detail-description').textContent = requirementData.description;
                document.getElementById('detail-background').textContent = requirementData.background;

                // å¡«å……éªŒæ”¶æ ‡å‡†
                const criteriaContainer = document.getElementById('detail-acceptance-criteria');
                criteriaContainer.innerHTML = '';
                requirementData.acceptanceCriteria.forEach(criteria => {
                    const div = document.createElement('div');
                    div.className = 'flex items-start space-x-2';
                    div.innerHTML = `
                        <span class="text-muted-foreground text-xs mt-1">â€¢</span>
                        <span class="text-sm">${criteria}</span>
                    `;
                    criteriaContainer.appendChild(div);
                });

                // å¡«å……å­éœ€æ±‚ç»Ÿè®¡
                const totalHours = subRequirementsData.reduce((sum, req) => sum + req.hours, 0);
                document.getElementById('detail-sub-count').textContent = subRequirementsData.length;
                document.getElementById('detail-total-hours').textContent = totalHours;
                document.getElementById('detail-progress').textContent = '0%'; // è¿™é‡Œå¯ä»¥æ ¹æ®å®é™…è¿›åº¦è®¡ç®—

                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                document.getElementById('requirement-detail-modal').classList.remove('hidden');
            }

            // éœ€æ±‚è¯¦æƒ…æ¨¡æ€æ¡†æ§åˆ¶
            const requirementDetailModal = document.getElementById('requirement-detail-modal');
            const closeRequirementDetailModal = document.getElementById('close-requirement-detail-modal');
            const closeDetailModal = document.getElementById('close-detail-modal');
            const gotoBreakdown = document.getElementById('goto-breakdown');

            // å…³é—­è¯¦æƒ…æ¨¡æ€æ¡†
            function closeRequirementDetailModalHandler() {
                requirementDetailModal.classList.add('hidden');
            }

            closeRequirementDetailModal.addEventListener('click', closeRequirementDetailModalHandler);
            closeDetailModal.addEventListener('click', closeRequirementDetailModalHandler);

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            requirementDetailModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeRequirementDetailModalHandler();
                }
            });

            // è¿›å…¥æ‹†åˆ†æŒ‰é’®
            gotoBreakdown.addEventListener('click', function() {
                // å…³é—­è¯¦æƒ…æ¨¡æ€æ¡†
                closeRequirementDetailModalHandler();

                // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ‡æ¢åˆ°æ‹†åˆ†è§†å›¾çš„é€»è¾‘
                // ä¾‹å¦‚ï¼šæ»šåŠ¨åˆ°å¯¹åº”çš„éœ€æ±‚é¡¹ï¼Œæˆ–è€…é«˜äº®æ˜¾ç¤ºç­‰
                showSuccessMessage('å·²è¿›å…¥éœ€æ±‚æ‹†åˆ†æ¨¡å¼');
            });

            // åŠ è½½å­éœ€æ±‚åˆ—è¡¨
            function loadSubRequirements(requirementId) {
                const subRequirementsData = getSubRequirementsData(requirementId);
                const container = document.getElementById('sub-requirements-list');

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                container.innerHTML = '<div class="text-center py-4 text-muted-foreground">åŠ è½½ä¸­...</div>';

                // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
                setTimeout(() => {
                    container.innerHTML = '';

                    if (subRequirementsData.length === 0) {
                        container.innerHTML = '<div class="text-center py-8 text-muted-foreground">æš‚æ— å­éœ€æ±‚ï¼Œç‚¹å‡»"æ–°å¢å­éœ€æ±‚"å¼€å§‹æ·»åŠ </div>';
                    } else {
                        subRequirementsData.forEach(subReq => {
                            const subReqElement = createSubRequirementElement(subReq);
                            container.appendChild(subReqElement);
                        });
                    }

                    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                    updateSubRequirementsStats(subRequirementsData);
                }, 300);
            }

            // è·å–å­éœ€æ±‚æ•°æ®
            function getSubRequirementsData(requirementId) {
                const mockData = {
                    'req-004': [
                        {
                            id: 'sub-req-001',
                            name: 'ç”¨æˆ·è§’è‰²ç®¡ç†æ¨¡å—',
                            description: 'å®ç°ç”¨æˆ·è§’è‰²çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤åŠŸèƒ½ï¼Œæ”¯æŒè§’è‰²æƒé™é…ç½®',
                            priority: 'medium',
                            hours: 5
                        },
                        {
                            id: 'sub-req-002',
                            name: 'æƒé™æ§åˆ¶æ¨¡å—',
                            description: 'å®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼Œæ”¯æŒèœå•æƒé™ã€æ“ä½œæƒé™ã€æ•°æ®æƒé™',
                            priority: 'high',
                            hours: 8
                        },
                        {
                            id: 'sub-req-003',
                            name: 'ç”¨æˆ·ç®¡ç†ç•Œé¢',
                            description: 'è®¾è®¡å’Œå¼€å‘ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒç”¨æˆ·ä¿¡æ¯ç»´æŠ¤å’Œè§’è‰²åˆ†é…',
                            priority: 'low',
                            hours: 3
                        }
                    ],
                    'req-005': [
                        {
                            id: 'sub-req-004',
                            name: 'å“åº”å¼å¸ƒå±€ä¼˜åŒ–',
                            description: 'ä¼˜åŒ–é¡µé¢å¸ƒå±€ï¼Œé€‚é…ç§»åŠ¨ç«¯å±å¹•å°ºå¯¸',
                            priority: 'high',
                            hours: 4
                        },
                        {
                            id: 'sub-req-005',
                            name: 'è§¦æ‘¸äº¤äº’ä¼˜åŒ–',
                            description: 'ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸äº¤äº’ä½“éªŒï¼Œæ”¯æŒæ‰‹åŠ¿æ“ä½œ',
                            priority: 'medium',
                            hours: 3
                        }
                    ]
                };
                return mockData[requirementId] || [];
            }

            // åˆ›å»ºå­éœ€æ±‚å…ƒç´ 
            function createSubRequirementElement(subReq) {
                const div = document.createElement('div');
                div.className = 'p-3 border border-border rounded';
                div.dataset.subRequirementId = subReq.id;

                const priorityMap = {
                    'low': 'ğŸŸ¢ ä½ä¼˜å…ˆçº§',
                    'medium': 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§',
                    'high': 'ğŸ”´ é«˜ä¼˜å…ˆçº§'
                };

                const priorityClass = {
                    'low': 'bg-muted text-muted-foreground',
                    'medium': 'bg-warning text-warning-foreground',
                    'high': 'bg-destructive text-destructive-foreground'
                };

                div.innerHTML = `
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <h4 class="font-medium text-sm">${subReq.name}</h4>
                            <p class="text-xs text-muted-foreground mt-1">${subReq.description}</p>
                            <div class="flex items-center space-x-2 mt-2">
                                <span class="px-2 py-1 ${priorityClass[subReq.priority]} text-xs rounded">${priorityMap[subReq.priority]}</span>
                                <span class="text-xs text-muted-foreground">é¢„ä¼°å·¥æ—¶: ${subReq.hours}å¤©</span>
                            </div>
                        </div>
                        <div class="flex space-x-2 ml-2">
                            <button class="px-2 py-1 border border-border rounded text-xs hover:bg-accent" data-action="edit-sub-requirement" data-sub-requirement-id="${subReq.id}">
                                ç¼–è¾‘
                            </button>
                            <button class="px-2 py-1 border border-destructive text-destructive rounded text-xs hover:bg-destructive/10" data-action="delete-sub-requirement" data-sub-requirement-id="${subReq.id}">
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                `;

                return div;
            }

            // æ›´æ–°å­éœ€æ±‚ç»Ÿè®¡ä¿¡æ¯
            function updateSubRequirementsStats(subRequirements) {
                const count = subRequirements.length;
                const totalHours = subRequirements.reduce((sum, req) => sum + req.hours, 0);

                document.getElementById('sub-requirements-count').textContent = count;
                document.getElementById('total-estimated-hours').textContent = totalHours;
            }

            // AIè¾…åŠ©æ‹†åˆ†åŠŸèƒ½
            const aiBreakdownBtn = document.getElementById('ai-breakdown-btn');
            const aiBreakdownModal = document.getElementById('ai-breakdown-modal');
            const closeAiBreakdownModal = document.getElementById('close-ai-breakdown-modal');
            const cancelAiBreakdown = document.getElementById('cancel-ai-breakdown');
            const startAiBreakdown = document.getElementById('start-ai-breakdown');
            const regenerateBreakdown = document.getElementById('regenerate-breakdown');
            const applyBreakdown = document.getElementById('apply-breakdown');

            // æ‰“å¼€AIè¾…åŠ©æ‹†åˆ†æ¨¡æ€æ¡†
            aiBreakdownBtn.addEventListener('click', function() {
                // æ›´æ–°å½“å‰éœ€æ±‚ä¿¡æ¯
                const selectedRequirementName = document.getElementById('selected-requirement-name').textContent;
                const selectedRequirementDesc = document.getElementById('selected-requirement-desc').textContent;

                document.getElementById('ai-breakdown-requirement-name').textContent = selectedRequirementName;
                document.getElementById('ai-breakdown-requirement-desc').textContent = selectedRequirementDesc;

                // é‡ç½®çŠ¶æ€
                document.getElementById('ai-breakdown-result-section').style.display = 'none';
                document.getElementById('ai-breakdown-loading').classList.add('hidden');

                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                aiBreakdownModal.classList.remove('hidden');
            });

            // å…³é—­AIæ‹†åˆ†æ¨¡æ€æ¡†
            function closeAiBreakdownModalHandler() {
                aiBreakdownModal.classList.add('hidden');
            }

            closeAiBreakdownModal.addEventListener('click', closeAiBreakdownModalHandler);
            cancelAiBreakdown.addEventListener('click', closeAiBreakdownModalHandler);

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            aiBreakdownModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAiBreakdownModalHandler();
                }
            });

            // å¼€å§‹AIæ‹†åˆ†
            startAiBreakdown.addEventListener('click', function() {
                performAiBreakdown();
            });

            // é‡æ–°ç”Ÿæˆæ‹†åˆ†
            regenerateBreakdown.addEventListener('click', function() {
                performAiBreakdown();
            });

            // åº”ç”¨æ‹†åˆ†ç»“æœ
            applyBreakdown.addEventListener('click', function() {
                applyAiBreakdownResults();
            });

            // æ‰§è¡ŒAIæ‹†åˆ†
            function performAiBreakdown() {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('ai-breakdown-loading').classList.remove('hidden');
                document.getElementById('ai-breakdown-result-section').style.display = 'none';

                // è·å–é…ç½®å‚æ•°
                const granularity = document.getElementById('ai-breakdown-granularity').value;
                const techStack = document.getElementById('ai-breakdown-tech-stack').value;
                const additionalInfo = document.getElementById('ai-breakdown-additional-info').value;
                const requirementName = document.getElementById('ai-breakdown-requirement-name').textContent;
                const requirementDesc = document.getElementById('ai-breakdown-requirement-desc').textContent;

                // æ¨¡æ‹ŸAIè°ƒç”¨ï¼ˆå®é™…é¡¹ç›®ä¸­è¿™é‡Œåº”è¯¥è°ƒç”¨çœŸå®çš„AI APIï¼‰
                setTimeout(() => {
                    const aiResults = generateAiBreakdownResults(requirementName, requirementDesc, granularity, techStack, additionalInfo);
                    displayAiBreakdownResults(aiResults);

                    // éšè—åŠ è½½çŠ¶æ€ï¼Œæ˜¾ç¤ºç»“æœ
                    document.getElementById('ai-breakdown-loading').classList.add('hidden');
                    document.getElementById('ai-breakdown-result-section').style.display = 'block';
                }, 2000 + Math.random() * 2000); // æ¨¡æ‹Ÿ2-4ç§’çš„AIå¤„ç†æ—¶é—´
            }

            // ç”ŸæˆAIæ‹†åˆ†ç»“æœï¼ˆæ¨¡æ‹ŸAIå¤§æ¨¡å‹çš„å“åº”ï¼‰
            function generateAiBreakdownResults(requirementName, requirementDesc, granularity, techStack, additionalInfo) {
                const baseResults = {
                    'ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ': [
                        {
                            name: 'ç”¨æˆ·è§’è‰²ç®¡ç†æ¨¡å—',
                            description: 'å®ç°ç”¨æˆ·è§’è‰²çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤åŠŸèƒ½ï¼Œæ”¯æŒè§’è‰²æƒé™é…ç½®å’Œè§’è‰²ç»§æ‰¿æœºåˆ¶',
                            priority: 'high',
                            estimatedHours: 8,
                            techDetails: 'ä½¿ç”¨Spring Securityå®ç°è§’è‰²ç®¡ç†ï¼Œæ”¯æŒRBACæƒé™æ¨¡å‹'
                        },
                        {
                            name: 'æƒé™æ§åˆ¶æ ¸å¿ƒå¼•æ“',
                            description: 'å®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶ï¼Œæ”¯æŒèœå•æƒé™ã€æ“ä½œæƒé™ã€æ•°æ®æƒé™çš„ç»Ÿä¸€ç®¡ç†',
                            priority: 'high',
                            estimatedHours: 12,
                            techDetails: 'åŸºäºAOPå®ç°æƒé™æ‹¦æˆªï¼Œæ”¯æŒæ³¨è§£å¼æƒé™æ§åˆ¶'
                        },
                        {
                            name: 'ç”¨æˆ·ç®¡ç†ç•Œé¢',
                            description: 'è®¾è®¡å’Œå¼€å‘ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒç”¨æˆ·ä¿¡æ¯ç»´æŠ¤ã€è§’è‰²åˆ†é…å’Œæƒé™æŸ¥çœ‹',
                            priority: 'medium',
                            estimatedHours: 6,
                            techDetails: 'ä½¿ç”¨Vue.jsæ„å»ºå“åº”å¼ç”¨æˆ·ç•Œé¢ï¼Œé›†æˆæƒé™æ ‘ç»„ä»¶'
                        },
                        {
                            name: 'æƒé™ç¼“å­˜æœºåˆ¶',
                            description: 'å®ç°æƒé™ä¿¡æ¯çš„ç¼“å­˜æœºåˆ¶ï¼Œæå‡æƒé™éªŒè¯æ€§èƒ½å’Œç³»ç»Ÿå“åº”é€Ÿåº¦',
                            priority: 'medium',
                            estimatedHours: 4,
                            techDetails: 'ä½¿ç”¨Redisç¼“å­˜ç”¨æˆ·æƒé™ä¿¡æ¯ï¼Œæ”¯æŒæƒé™å˜æ›´æ—¶çš„ç¼“å­˜åˆ·æ–°'
                        },
                        {
                            name: 'æƒé™å®¡è®¡æ—¥å¿—',
                            description: 'è®°å½•æƒé™å˜æ›´å’Œè®¿é—®æ—¥å¿—ï¼Œæ”¯æŒæƒé™å®¡è®¡å’Œå®‰å…¨ç›‘æ§',
                            priority: 'low',
                            estimatedHours: 5,
                            techDetails: 'åŸºäºAOPè®°å½•æƒé™æ“ä½œæ—¥å¿—ï¼Œæ”¯æŒæ—¥å¿—æŸ¥è¯¢å’Œå¯¼å‡º'
                        }
                    ],
                    'ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–': [
                        {
                            name: 'å“åº”å¼å¸ƒå±€é‡æ„',
                            description: 'é‡æ„ç°æœ‰é¡µé¢å¸ƒå±€ï¼Œå®ç°å®Œå…¨å“åº”å¼è®¾è®¡ï¼Œé€‚é…å„ç§ç§»åŠ¨è®¾å¤‡å±å¹•',
                            priority: 'high',
                            estimatedHours: 10,
                            techDetails: 'ä½¿ç”¨CSS Gridå’ŒFlexboxå®ç°å“åº”å¼å¸ƒå±€ï¼Œæ”¯æŒæ–­ç‚¹é€‚é…'
                        },
                        {
                            name: 'è§¦æ‘¸äº¤äº’ä¼˜åŒ–',
                            description: 'ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸äº¤äº’ä½“éªŒï¼Œæ”¯æŒæ‰‹åŠ¿æ“ä½œå’Œè§¦æ‘¸åé¦ˆ',
                            priority: 'high',
                            estimatedHours: 8,
                            techDetails: 'é›†æˆHammer.jså¤„ç†æ‰‹åŠ¿äº‹ä»¶ï¼Œä¼˜åŒ–è§¦æ‘¸åŒºåŸŸå¤§å°'
                        },
                        {
                            name: 'ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ–',
                            description: 'ä¼˜åŒ–ç§»åŠ¨ç«¯é¡µé¢åŠ è½½é€Ÿåº¦å’Œè¿è¡Œæ€§èƒ½ï¼Œå‡å°‘èµ„æºæ¶ˆè€—',
                            priority: 'medium',
                            estimatedHours: 6,
                            techDetails: 'å®ç°æ‡’åŠ è½½ã€å›¾ç‰‡å‹ç¼©å’Œä»£ç åˆ†å‰²ï¼Œä¼˜åŒ–é¦–å±åŠ è½½æ—¶é—´'
                        },
                        {
                            name: 'ç§»åŠ¨ç«¯ç»„ä»¶åº“',
                            description: 'å¼€å‘ç§»åŠ¨ç«¯ä¸“ç”¨ç»„ä»¶åº“ï¼Œæä¾›ä¸€è‡´çš„ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒ',
                            priority: 'medium',
                            estimatedHours: 12,
                            techDetails: 'åŸºäºVue.jså¼€å‘ç§»åŠ¨ç«¯ç»„ä»¶åº“ï¼Œæ”¯æŒä¸»é¢˜å®šåˆ¶'
                        }
                    ]
                };

                let results = baseResults[requirementName] || baseResults['ç”¨æˆ·æƒé™ç®¡ç†ç³»ç»Ÿ'];

                // æ ¹æ®ç²’åº¦è°ƒæ•´ç»“æœæ•°é‡
                if (granularity === 'coarse') {
                    results = results.slice(0, 3);
                } else if (granularity === 'fine') {
                    // ä¸ºç»†ç²’åº¦æ·»åŠ æ›´å¤šå­éœ€æ±‚
                    results = [...results, {
                        name: 'æƒé™é…ç½®ç®¡ç†',
                        description: 'æä¾›æƒé™é…ç½®çš„å¯è§†åŒ–ç®¡ç†ç•Œé¢ï¼Œæ”¯æŒæƒé™æ¨¡æ¿å’Œæ‰¹é‡é…ç½®',
                        priority: 'low',
                        estimatedHours: 4,
                        techDetails: 'ä½¿ç”¨æ‹–æ‹½å¼ç•Œé¢è®¾è®¡æƒé™é…ç½®æµç¨‹'
                    }];
                }

                return results;
            }

            // æ˜¾ç¤ºAIæ‹†åˆ†ç»“æœ
            function displayAiBreakdownResults(results) {
                const container = document.getElementById('ai-breakdown-results');
                container.innerHTML = '';

                results.forEach((result, index) => {
                    const resultElement = document.createElement('div');
                    resultElement.className = 'p-4 border border-border rounded-lg bg-muted/30 ai-breakdown-result';

                    const priorityMap = {
                        'low': { text: 'ğŸŸ¢ ä½ä¼˜å…ˆçº§', class: 'bg-muted text-muted-foreground' },
                        'medium': { text: 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§', class: 'bg-warning text-warning-foreground' },
                        'high': { text: 'ğŸ”´ é«˜ä¼˜å…ˆçº§', class: 'bg-destructive text-destructive-foreground' }
                    };

                    const priority = priorityMap[result.priority];

                    resultElement.innerHTML = `
                        <div class="flex items-start justify-between mb-3">
                            <h5 class="font-medium text-sm">${result.name}</h5>
                            <div class="flex items-center space-x-2">
                                <span class="px-2 py-1 ${priority.class} text-xs rounded">${priority.text}</span>
                                <span class="text-xs text-muted-foreground">${result.estimatedHours}å¤©</span>
                            </div>
                        </div>
                        <p class="text-sm text-muted-foreground mb-2">${result.description}</p>
                        <div class="text-xs text-muted-foreground bg-muted p-2 rounded">
                            <strong>æŠ€æœ¯å®ç°ï¼š</strong>${result.techDetails}
                        </div>
                    `;

                    container.appendChild(resultElement);
                });
            }

            // åº”ç”¨AIæ‹†åˆ†ç»“æœ
            function applyAiBreakdownResults() {
                const results = document.querySelectorAll('#ai-breakdown-results > div');
                const subRequirements = [];

                results.forEach((resultElement, index) => {
                    const name = resultElement.querySelector('h5').textContent;
                    const description = resultElement.querySelector('p').textContent;
                    const priorityText = resultElement.querySelector('.px-2.py-1').textContent;
                    const hours = parseInt(resultElement.querySelector('.text-xs.text-muted-foreground:last-of-type').textContent);

                    let priority = 'medium';
                    if (priorityText.includes('é«˜ä¼˜å…ˆçº§')) priority = 'high';
                    else if (priorityText.includes('ä½ä¼˜å…ˆçº§')) priority = 'low';

                    const subRequirement = {
                        id: 'ai-sub-req-' + Date.now() + '-' + index,
                        name: name,
                        description: description,
                        priority: priority,
                        hours: hours,
                        source: 'AIç”Ÿæˆ'
                    };

                    subRequirements.push(subRequirement);
                });

                // æ¸…ç©ºç°æœ‰å­éœ€æ±‚åˆ—è¡¨
                const container = document.getElementById('sub-requirements-list');
                container.innerHTML = '';

                // æ·»åŠ AIç”Ÿæˆçš„å­éœ€æ±‚
                subRequirements.forEach(subReq => {
                    const subReqElement = createSubRequirementElement(subReq);
                    container.appendChild(subReqElement);
                });

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateSubRequirementsStats(subRequirements);

                // æ›´æ–°å·¦ä¾§éœ€æ±‚é¡¹çš„å­éœ€æ±‚æ•°é‡
                updateRequirementItemCount(currentSelectedRequirement, subRequirements.length);

                // å…³é—­æ¨¡æ€æ¡†
                closeAiBreakdownModalHandler();

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showSuccessMessage(`AIæˆåŠŸç”Ÿæˆäº† ${subRequirements.length} ä¸ªå­éœ€æ±‚`);
            }

            // æ–°å¢å­éœ€æ±‚æ¨¡æ€æ¡†åŠŸèƒ½
            const addSubRequirementBtn = document.getElementById('add-sub-requirement-btn');
            const addSubRequirementModal = document.getElementById('add-sub-requirement-modal');
            const closeSubRequirementModal = document.getElementById('close-sub-requirement-modal');
            const cancelSubRequirement = document.getElementById('cancel-sub-requirement');
            const subRequirementForm = document.getElementById('sub-requirement-form');

            // æ‰“å¼€æ–°å¢å­éœ€æ±‚æ¨¡æ€æ¡†
            addSubRequirementBtn.addEventListener('click', function() {
                // æ›´æ–°çˆ¶éœ€æ±‚åç§°
                const selectedRequirementName = document.getElementById('selected-requirement-name').textContent;
                document.getElementById('parent-requirement-name').textContent = selectedRequirementName;

                // é‡ç½®è¡¨å•
                subRequirementForm.reset();

                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                addSubRequirementModal.classList.remove('hidden');
            });

            // å…³é—­æ¨¡æ€æ¡†
            function closeSubRequirementModalHandler() {
                addSubRequirementModal.classList.add('hidden');
            }

            closeSubRequirementModal.addEventListener('click', closeSubRequirementModalHandler);
            cancelSubRequirement.addEventListener('click', closeSubRequirementModalHandler);

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            addSubRequirementModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeSubRequirementModalHandler();
                }
            });

            // æäº¤å­éœ€æ±‚è¡¨å•
            subRequirementForm.addEventListener('submit', function(e) {
                e.preventDefault();

                const formData = new FormData(this);
                const subRequirement = {
                    id: 'sub-req-' + Date.now(),
                    name: formData.get('name'),
                    description: formData.get('description'),
                    priority: formData.get('priority'),
                    hours: parseFloat(formData.get('hours')) || 1,
                    assignee: formData.get('assignee'),
                    tags: formData.get('tags')
                };

                // éªŒè¯å¿…å¡«å­—æ®µ
                if (!subRequirement.name.trim() || !subRequirement.description.trim()) {
                    alert('è¯·å¡«å†™å¿…å¡«å­—æ®µ');
                    return;
                }

                // æ·»åŠ å­éœ€æ±‚åˆ°åˆ—è¡¨
                addSubRequirementToList(subRequirement);

                // å…³é—­æ¨¡æ€æ¡†
                closeSubRequirementModalHandler();

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showSuccessMessage('å­éœ€æ±‚æ·»åŠ æˆåŠŸ');
            });

            // æ·»åŠ å­éœ€æ±‚åˆ°åˆ—è¡¨
            function addSubRequirementToList(subRequirement) {
                const container = document.getElementById('sub-requirements-list');

                // å¦‚æœæ˜¯ç©ºçŠ¶æ€ï¼Œæ¸…ç©ºå®¹å™¨
                if (container.querySelector('.text-center')) {
                    container.innerHTML = '';
                }

                // åˆ›å»ºå¹¶æ·»åŠ æ–°çš„å­éœ€æ±‚å…ƒç´ 
                const subReqElement = createSubRequirementElement(subRequirement);
                container.appendChild(subReqElement);

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                const currentSubReqs = getSubRequirementsData(currentSelectedRequirement);
                currentSubReqs.push(subRequirement);
                updateSubRequirementsStats(currentSubReqs);

                // æ›´æ–°å·¦ä¾§éœ€æ±‚é¡¹çš„å­éœ€æ±‚æ•°é‡
                updateRequirementItemCount(currentSelectedRequirement, currentSubReqs.length);
            }

            // æ›´æ–°éœ€æ±‚é¡¹çš„å­éœ€æ±‚æ•°é‡
            function updateRequirementItemCount(requirementId, count) {
                const requirementItem = document.querySelector(`[data-requirement-id="${requirementId}"]`);
                if (requirementItem) {
                    const countElement = requirementItem.querySelector('.font-medium');
                    if (countElement) {
                        countElement.textContent = count;
                    }
                }
            }

            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            function showSuccessMessage(message) {
                // åˆ›å»ºä¸´æ—¶æç¤ºå…ƒç´ 
                const toast = document.createElement('div');
                toast.className = 'fixed top-4 right-4 bg-success text-success-foreground px-4 py-2 rounded-md shadow-lg z-50';
                toast.textContent = message;
                document.body.appendChild(toast);

                // 3ç§’åè‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 3000);
            }

            // å­éœ€æ±‚æœç´¢åŠŸèƒ½
            const requirementSearch = document.getElementById('requirement-search');
            requirementSearch.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const requirementItems = document.querySelectorAll('.requirement-item');

                requirementItems.forEach(item => {
                    const name = item.dataset.requirementName.toLowerCase();
                    const description = item.querySelector('.text-xs.text-muted-foreground:last-of-type').textContent.toLowerCase();

                    if (name.includes(searchTerm) || description.includes(searchTerm)) {
                        item.style.display = '';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            // åˆå§‹åŒ–éœ€æ±‚æ‹†åˆ†é¡µé¢
            if (document.querySelector('[data-tab-content="requirement-breakdown"]')) {
                // é»˜è®¤åŠ è½½ç¬¬ä¸€ä¸ªéœ€æ±‚çš„å­éœ€æ±‚
                loadSubRequirements(currentSelectedRequirement);
            }

            // æµ‹è¯•å‡½æ•° - éªŒè¯äº‹ä»¶å¤„ç†æ˜¯å¦æ­£ç¡®
            window.testRequirementInteraction = function() {
                console.log('=== éœ€æ±‚æ‹†åˆ†äº¤äº’æµ‹è¯• ===');
                console.log('å½“å‰é€‰ä¸­éœ€æ±‚:', currentSelectedRequirement);
                console.log('éœ€æ±‚é¡¹æ•°é‡:', document.querySelectorAll('.requirement-item').length);
                console.log('è¯¦æƒ…æŒ‰é’®æ•°é‡:', document.querySelectorAll('[data-action="view-requirement-detail"]').length);
                console.log('ä¸»è¦å†…å®¹åŒºåŸŸæ•°é‡:', document.querySelectorAll('.requirement-item .flex-1').length);
                console.log('=== æµ‹è¯•å®Œæˆ ===');
            };
        });
    </script>
</body>
</html>
